# üö® –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï - –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Å–µ—Ç–µ–≤–æ–≥–æ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è

## –ü—Ä–æ–±–ª–µ–º–∞

**CRITICAL:** –ú–µ—Ç–æ–¥ `check_decommissioned_devices()` –ø—Ä–æ–≤–µ—Ä—è–ª **–í–°–ï** —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –≤ NetBox, –≤–∫–ª—é—á–∞—è —Å–µ—Ç–µ–≤—ã–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ (switches, routers, firewalls), –∫–æ—Ç–æ—Ä—ã–µ —É–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω—ã–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–º.

### –°–∏–º–ø—Ç–æ–º—ã:
```
2025-11-17 05:30:04,953 - sync - INFO - –ù–∞–π–¥–µ–Ω–æ 350 —Ö–æ—Å—Ç–æ–≤ –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏  ‚Üê –ü—Ä–∞–≤–∏–ª—å–Ω–æ (—Ç–æ–ª—å–∫–æ —Å–µ—Ä–≤–µ—Ä—ã)
2025-11-17 05:30:06,176 - sync - INFO - –£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ 5900sw –ø–æ–º–µ—á–µ–Ω–æ –∫–∞–∫ decommissioning  ‚Üê –û–®–ò–ë–ö–ê (—ç—Ç–æ switch!)
2025-11-17 05:30:06,365 - sync - INFO - –£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ ao-nit-edge-sw01-ast-dc01 –ø–æ–º–µ—á–µ–Ω–æ –∫–∞–∫ decommissioning  ‚Üê –û–®–ò–ë–ö–ê!
...
2025-11-17 05:30:55,564 - sync - INFO -   üóë Decommissioned: 214  ‚Üê 214 —Å–µ—Ç–µ–≤—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞!
```

**–ß—Ç–æ –ø—Ä–æ–∏–∑–æ—à–ª–æ:**
- ‚úÖ 350 **—Å–µ—Ä–≤–µ—Ä–æ–≤** –ø—Ä–∞–≤–∏–ª—å–Ω–æ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–ª–∏—Å—å –∏–∑ Zabbix (—Ç–æ–ª—å–∫–æ VMware Hypervisor)
- ‚ùå –ù–æ –∑–∞—Ç–µ–º –º–µ—Ç–æ–¥ `check_decommissioned_devices()` –ø—Ä–æ–≤–µ—Ä–∏–ª **–í–°–ï** —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –≤ NetBox
- ‚ùå 214 —Å–µ—Ç–µ–≤—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤ (switches, routers, firewalls) –±—ã–ª–∏ –ø–æ–º–µ—á–µ–Ω—ã –∫–∞–∫ decommissioning
- ‚ùå –≠—Ç–æ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ —É–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –¥—Ä—É–≥–∏–º —Å–µ—Ä–≤–∏—Å–æ–º –∏ –ù–ï –¥–æ–ª–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä—è—Ç—å—Å—è —ç—Ç–∏–º —Å–∫—Ä–∏–ø—Ç–æ–º

### –ü—Ä–∏—á–∏–Ω—ã:

1. **–ú–µ—Ç–æ–¥ `get_vmware_hosts()` —Ä–∞–±–æ—Ç–∞–ª –ø—Ä–∞–≤–∏–ª—å–Ω–æ**: —Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–ª —Ç–æ–ª—å–∫–æ —Å–µ—Ä–≤–µ—Ä—ã –∏–∑ Zabbix
2. **–ù–û –º–µ—Ç–æ–¥ `check_decommissioned_devices()` –ù–ï —Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–ª**: –ø—Ä–æ–≤–µ—Ä—è–ª –í–°–ï —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –≤ NetBox —Å zabbix_hostid
3. **–°–µ—Ç–µ–≤—ã–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞:**
   - –ò–º–µ—é—Ç zabbix_hostid (–∏—Ö —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç –¥—Ä—É–≥–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä)
   - –ò—Ö hostid –ù–ï–¢ –≤ —Å–ø–∏—Å–∫–µ active_host_ids (—Å–ø–∏—Å–æ–∫ —Å–µ—Ä–≤–µ—Ä–æ–≤!)
   - –ü–æ—ç—Ç–æ–º—É –ø–æ–º–µ—á–∞–ª–∏—Å—å –∫–∞–∫ decommissioning

---

## –†–µ—à–µ–Ω–∏–µ

### –ß—Ç–æ –∏–∑–º–µ–Ω–µ–Ω–æ –≤ `sync.py`:

#### 1. –ú–µ—Ç–æ–¥ `check_decommissioned_devices()` - –û–°–ù–û–í–ù–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï

**–ü—Ä–æ–±–ª–µ–º–∞:**
```python
# –ë–´–õ–û: –ü—Ä–æ–≤–µ—Ä—è–ª–∏—Å—å –í–°–ï —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –≤ NetBox
netbox_devices = self.netbox.dcim.devices.filter(
    cf_zabbix_hostid__n=False,
    status='active'
)

for device in netbox_devices:
    zabbix_hostid = device.custom_fields.get('zabbix_hostid')
    if zabbix_hostid and zabbix_hostid not in active_host_ids:
        self._mark_as_decommissioning(device, zabbix_hostid)  # ‚Üê –°–µ—Ç–µ–≤–æ–µ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ —Ç–æ–∂–µ!
```

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
```python
# –°–¢–ê–õ–û: –î–æ–±–∞–≤–ª–µ–Ω–∞ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Å–µ—Ç–µ–≤–æ–≥–æ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è
NETWORK_DEVICE_PATTERNS = [
    r'-sw\d', r'-sw-', r'-rt\d', r'-fw\d',
    r'leaf-', r'spine-', r'edge-', r'mgmt-ac-', r'mgmt-ag-',
    r'col-edge', r'cloud-edge', r'cloud-leaf', r'cloud-spine',
    r'\d+sw$'
]

for device in netbox_devices:
    # –§–ò–õ–¨–¢–†: –ü—Ä–æ–ø—É—Å–∫–∞–µ–º —Å–µ—Ç–µ–≤–æ–µ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ
    is_network_device = any(
        re.search(pattern, device.name, re.IGNORECASE)
        for pattern in NETWORK_DEVICE_PATTERNS
    )

    if is_network_device:
        excluded_network_count += 1
        continue  # ‚Üê –ü—Ä–æ–ø—É—Å–∫–∞–µ–º!

    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –¢–û–õ–¨–ö–û —Å–µ—Ä–≤–µ—Ä–Ω—ã–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
    zabbix_hostid = device.custom_fields.get('zabbix_hostid')
    if zabbix_hostid and zabbix_hostid not in active_host_ids:
        self._mark_as_decommissioning(device, zabbix_hostid)
```

#### 2. –ú–µ—Ç–æ–¥ `_check_for_deletion()` - —Ç–æ–∂–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω

–ü—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ —Ñ–∏–∑–∏—á–µ—Å–∫–æ–≥–æ —É–¥–∞–ª–µ–Ω–∏—è —Ç–∞–∫–∂–µ –¥–æ–±–∞–≤–ª–µ–Ω —Ñ–∏–ª—å—Ç—Ä —Å–µ—Ç–µ–≤–æ–≥–æ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è:

```python
if config.ENABLE_PHYSICAL_DELETION:
    for device in decommissioning_devices:
        # –§–ò–õ–¨–¢–†: –ü—Ä–æ–ø—É—Å–∫–∞–µ–º —Å–µ—Ç–µ–≤–æ–µ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ
        is_network_device = any(
            re.search(pattern, device.name, re.IGNORECASE)
            for pattern in NETWORK_DEVICE_PATTERNS
        )

        if is_network_device:
            continue  # ‚Üê –ù–µ —É–¥–∞–ª—è–µ–º —Å–µ—Ç–µ–≤–æ–µ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ!

        self._check_for_deletion(device)
```

#### 3. –£–ª—É—á—à–µ–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–¢–µ–ø–µ—Ä—å –≤ –ª–æ–≥–∞—Ö –≤–∏–¥–Ω–æ:
```
üìä –ü—Ä–æ–≤–µ—Ä–∫–∞ decommissioning: –∏—Å–∫–ª—é—á–µ–Ω–æ 218 —Å–µ—Ç–µ–≤—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤, –ø—Ä–æ–≤–µ—Ä–µ–Ω–æ 5 —Å–µ—Ä–≤–µ—Ä–æ–≤
```

#### 4. –ú–µ—Ç–æ–¥ `get_vmware_hosts()` - –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∑–∞—â–∏—Ç–∞

–¢–∞–∫–∂–µ —É–ª—É—á—à–µ–Ω–∞ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Ö–æ—Å—Ç–æ–≤ –∏–∑ Zabbix:
- –¢–æ—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ —à–∞–±–ª–æ–Ω–æ–≤ (==) –≤–º–µ—Å—Ç–æ –ø–æ–¥—Å—Ç—Ä–æ–∫–∏ (in)
- –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –ø–∞—Ç—Ç–µ—Ä–Ω–∞–º –∏–º–µ–Ω (–Ω–∞ –≤—Å—è–∫–∏–π —Å–ª—É—á–∞–π)
- –ü–æ–¥—Ä–æ–±–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏

---

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### –ù–∞ –≤–∞—à–µ–º —Å–µ—Ä–≤–µ—Ä–µ:

```bash
cd /home/admintelegrambot/cloud-services/prods-z-n

# –ü–æ–ª—É—á–∏—Ç—å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
git pull origin claude/project-logic-analysis-011CV5GjbVGGhUPFT3uuevqp

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
git log --oneline -5

# –í–ê–ñ–ù–û: –¢–µ—Å—Ç–æ–≤—ã–π –∑–∞–ø—É—Å–∫
DRY_RUN=true docker compose up
```

### –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:

**–î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
```
–ù–∞–π–¥–µ–Ω–æ 350 —Ö–æ—Å—Ç–æ–≤ –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏  ‚Üê 350 —Å–µ—Ä–≤–µ—Ä–æ–≤ (–ø—Ä–∞–≤–∏–ª—å–Ω–æ)
–ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤...
–£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ 5900sw –ø–æ–º–µ—á–µ–Ω–æ –∫–∞–∫ decommissioning  ‚Üê –û–®–ò–ë–ö–ê (—ç—Ç–æ switch!)
–£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ ao-nit-edge-sw01 –ø–æ–º–µ—á–µ–Ω–æ –∫–∞–∫ decommissioning  ‚Üê –û–®–ò–ë–ö–ê!
...
üóë Decommissioned: 214  ‚Üê 214 —Å–µ—Ç–µ–≤—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –ø–æ–º–µ—á–µ–Ω–æ (–ù–ï–ü–†–ê–í–ò–õ–¨–ù–û!)
```

**–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
```
üìä –ü–æ–ª—É—á–µ–Ω–æ 568 —Ö–æ—Å—Ç–æ–≤ –∏–∑ Zabbix (–¥–æ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏)  ‚Üê 350 —Å–µ—Ä–≤–µ—Ä–æ–≤ + 218 —Å–µ—Ç–µ–≤—ã—Ö
üìã –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏:
  ‚Ä¢ –í—Å–µ–≥–æ –∏–∑ Zabbix: 568
  ‚Ä¢ –°–µ—Ç–µ–≤–æ–µ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ (–∏—Å–∫–ª—é—á–µ–Ω–æ –ø–æ –∏–º–µ–Ω–∏): 218  ‚Üê –ò—Å–∫–ª—é—á–∞—é—Ç—Å—è!
  ‚úì –ò—Ç–æ–≥–æ –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏: 350  ‚Üê –¢–æ–ª—å–∫–æ —Å–µ—Ä–≤–µ—Ä—ã

–ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤...
üìä –ü—Ä–æ–≤–µ—Ä–∫–∞ decommissioning: –∏—Å–∫–ª—é—á–µ–Ω–æ 218 —Å–µ—Ç–µ–≤—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤, –ø—Ä–æ–≤–µ—Ä–µ–Ω–æ 5 —Å–µ—Ä–≤–µ—Ä–æ–≤
üóë Decommissioned: 0  ‚Üê –°–µ—Ç–µ–≤—ã–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –ù–ï —Ç—Ä–æ–≥–∞—é—Ç—Å—è!
```

---

## –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ—Å–ª–µ –ø—Ä–æ–±–ª–µ–º—ã

–ï—Å–ª–∏ —Å–µ—Ç–µ–≤—ã–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ —É–∂–µ –±—ã–ª–∏ –ø–æ–º–µ—á–µ–Ω—ã –∫–∞–∫ decommissioning –≤ NetBox:

### –í–∞—Ä–∏–∞–Ω—Ç 1: –í—Ä—É—á–Ω—É—é —á–µ—Ä–µ–∑ NetBox UI

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ NetBox ‚Üí Devices ‚Üí Filters
2. –§–∏–ª—å—Ç—Ä: `Status = Decommissioning`
3. –ù–∞–π–¥–∏—Ç–µ —Å–µ—Ç–µ–≤—ã–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ (switches, routers)
4. –ò–∑–º–µ–Ω–∏—Ç–µ —Å—Ç–∞—Ç—É—Å –æ–±—Ä–∞—Ç–Ω–æ –Ω–∞ `Active`
5. –û—á–∏—Å—Ç–∏—Ç–µ `decommissioned_date` –≤ custom fields

### –í–∞—Ä–∏–∞–Ω—Ç 2: –ß–µ—Ä–µ–∑ API (–±—ã—Å—Ç—Ä–µ–µ –¥–ª—è –º–∞—Å—Å–æ–≤—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π)

```python
# recovery_script.py
import pynetbox
import re

nb = pynetbox.api('http://your-netbox-url', token='your-token')

# –ü–∞—Ç—Ç–µ—Ä–Ω—ã —Å–µ—Ç–µ–≤—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤
NETWORK_PATTERNS = ['-sw', '-rt', '-fw', 'leaf-', 'spine-', 'edge-', 'mgmt-']

# –ù–∞–π—Ç–∏ –≤—Å–µ decommissioned —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
devices = nb.dcim.devices.filter(status='decommissioning')

recovered = []
for device in devices:
    # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ —ç—Ç–æ —Å–µ—Ç–µ–≤–æ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ
    is_network = any(pattern in device.name.lower() for pattern in NETWORK_PATTERNS)

    if is_network:
        print(f"–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ: {device.name}")
        device.status = 'active'
        device.custom_fields['decommissioned_date'] = None
        device.save()
        recovered.append(device.name)

print(f"\n‚úÖ –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ {len(recovered)} —Å–µ—Ç–µ–≤—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤")
```

### –í–∞—Ä–∏–∞–Ω—Ç 3: –û—Å—Ç–∞–≤–∏—Ç—å –∫–∞–∫ –µ—Å—Ç—å

–ï—Å–ª–∏ —Å–µ—Ç–µ–≤—ã–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ —É–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –¥—Ä—É–≥–∏–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–º:
- –û–Ω –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç –∏—Ö —Å—Ç–∞—Ç—É—Å –ø—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
- –ù–û —É–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ —É –Ω–µ–≥–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –≤—ã—à–µ –∏–ª–∏ –æ–Ω –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —á–∞—â–µ

---

## –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ —Ä–∞–±–æ—Ç—ã

### 1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ —Ñ–∏–ª—å—Ç—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç:

```bash
DRY_RUN=true LOG_LEVEL=DEBUG docker compose up 2>&1 | grep "–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏" -A 10
```

–í—ã –¥–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å:
```
üìã –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏:
  ‚Ä¢ –í—Å–µ–≥–æ –∏–∑ Zabbix: 350
  ‚Ä¢ –°–µ—Ç–µ–≤–æ–µ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ (–∏—Å–∫–ª—é—á–µ–Ω–æ –ø–æ –∏–º–µ–Ω–∏): 214
  ‚úì –ò—Ç–æ–≥–æ –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏: ~36
```

### 2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ —Å–µ—Ç–µ–≤–æ–µ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ –ù–ï —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç—Å—è:

```bash
DRY_RUN=true docker compose up 2>&1 | grep -E "leaf-|spine-|edge-sw|mgmt-ac-sw" | head -20
```

**–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** –ù–ï–¢ —É–ø–æ–º–∏–Ω–∞–Ω–∏–π —Å–µ—Ç–µ–≤–æ–≥–æ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è –≤ –ª–æ–≥–∞—Ö —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏

**–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** –í–∏–¥–∏—Ç–µ "–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ leaf-sw01" - —Ñ–∏–ª—å—Ç—Ä –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

### 3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –¢–û–õ–¨–ö–û —Å–µ—Ä–≤–µ—Ä—ã —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É—é—Ç—Å—è:

```bash
DRY_RUN=true LOG_LEVEL=DEBUG docker compose up 2>&1 | grep "‚úÖ.*VMware Hypervisor —Ö–æ—Å—Ç"
```

–í—ã –¥–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å —Ç–æ–ª—å–∫–æ —Å–µ—Ä–≤–µ—Ä—ã (–±–µ–∑ switches/routers/firewalls)

---

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ

### `.env` - –ë–µ–∑–æ–ø–∞—Å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:

```bash
# === –§–ò–õ–¨–¢–†–ê–¶–ò–Ø ===
# –ü—Ä–æ–≥—Ä–∞–º–º–∞ —Ç–µ–ø–µ—Ä—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—Å–∫–ª—é—á–∞–µ—Ç —Å–µ—Ç–µ–≤–æ–µ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ
# –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è

# === DECOMMISSIONING ===
# –í–ê–ñ–ù–û: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏!

# –°–∫–æ–ª—å–∫–æ –¥–Ω–µ–π –Ω–µ–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –¥–æ decommissioning
DECOMMISSION_AFTER_DAYS=30  # –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è 30-90 –¥–Ω–µ–π

# –°–∫–æ–ª—å–∫–æ –¥–Ω–µ–π –≤ decommissioning –¥–æ —Ñ–∏–∑–∏—á–µ—Å–∫–æ–≥–æ —É–¥–∞–ª–µ–Ω–∏—è
DELETE_AFTER_DECOMMISSION_DAYS=90  # –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è 90-180 –¥–Ω–µ–π

# –í–∫–ª—é—á–∏—Ç—å —Ñ–∏–∑–∏—á–µ—Å–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ (–û–ü–ê–°–ù–û!)
ENABLE_PHYSICAL_DELETION=false  # –û—Å—Ç–∞–≤—å—Ç–µ false –ø–æ–∫–∞ –Ω–µ —É–≤–µ—Ä–µ–Ω—ã!

# === –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–¨ ===
# –ó–∞—â–∏—â–µ–Ω–Ω—ã–µ –ø–æ–ª—è (–ù–ï –ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –∏–∑ Zabbix)
PROTECTED_FIELDS=comments,description
PROTECTED_CUSTOM_FIELDS=manual_notes,warranty_end
```

### ‚ö†Ô∏è –ü–†–ï–î–£–ü–†–ï–ñ–î–ï–ù–ò–Ø:

1. **–ù–ï –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ** `DECOMMISSION_AFTER_DAYS=1` –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ
   - –≠—Ç–æ –ø—Ä–∏–≤–µ–¥–µ—Ç –∫ –¥–µ–∞–∫—Ç–∏–≤–∞—Ü–∏–∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤ –ø—Ä–∏ –º–∞–ª–µ–π—à–µ–º —Å–±–æ–µ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
   - –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –º–∏–Ω–∏–º—É–º 7-30 –¥–Ω–µ–π

2. **–ù–ï –≤–∫–ª—é—á–∞–π—Ç–µ** `ENABLE_PHYSICAL_DELETION=true` –±–µ–∑ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
   - –§–∏–∑–∏—á–µ—Å–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ –ù–ï–û–ë–†–ê–¢–ò–ú–û
   - –°–Ω–∞—á–∞–ª–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–æ–ª—å–∫–æ decommissioning

3. **–í–°–ï–ì–î–ê —Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ** —Å `DRY_RUN=true` –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ

---

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ü–æ–ª–Ω—ã–π —Ü–∏–∫–ª —Ç–µ—Å—Ç–∞:

```bash
cd /home/admintelegrambot/cloud-services/prods-z-n

# 1. –û–±–Ω–æ–≤–∏—Ç—å –∫–æ–¥
git pull origin claude/project-logic-analysis-011CV5GjbVGGhUPFT3uuevqp

# 2. –¢–µ—Å—Ç–æ–≤—ã–π –∑–∞–ø—É—Å–∫ (DRY RUN)
DRY_RUN=true docker compose up

# 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –≤ –≤—ã–≤–æ–¥–µ
# –û–∂–∏–¥–∞–µ–º: ~214 —Å–µ—Ç–µ–≤—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤ –∏—Å–∫–ª—é—á–µ–Ω–æ, ~36 —Å–µ—Ä–≤–µ—Ä–æ–≤ –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏

# 4. –ï—Å–ª–∏ –≤—Å–µ –û–ö - –∑–∞–ø—É—Å–∫ –≤ –±–æ–µ–≤–æ–º —Ä–µ–∂–∏–º–µ
docker compose run --rm sync-app

# 5. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ NetBox
# - –°–µ—Ç–µ–≤—ã–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –ù–ï –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∑–∞—Ç—Ä–æ–Ω—É—Ç—ã
# - –¢–æ–ª—å–∫–æ —Å–µ—Ä–≤–µ—Ä—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω—ã
```

---

## –ö–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã–π —Å–ø–∏—Å–æ–∫

–ü–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:

- [ ] –ö–æ–¥ –æ–±–Ω–æ–≤–ª–µ–Ω –¥–æ –ø–æ—Å–ª–µ–¥–Ω–µ–π –≤–µ—Ä—Å–∏–∏ –≤–µ—Ç–∫–∏
- [ ] –¢–µ—Å—Ç–æ–≤—ã–π –∑–∞–ø—É—Å–∫ —Å `DRY_RUN=true` –≤—ã–ø–æ–ª–Ω–µ–Ω —É—Å–ø–µ—à–Ω–æ
- [ ] –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ —Ü–∏—Ñ—Ä—ã
- [ ] –°–µ—Ç–µ–≤–æ–µ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ –ù–ï —É–ø–æ–º–∏–Ω–∞–µ—Ç—Å—è –≤ –ª–æ–≥–∞—Ö —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
- [ ] –¢–æ–ª—å–∫–æ —Å–µ—Ä–≤–µ—Ä—ã —Å VMware Hypervisor —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É—é—Ç—Å—è
- [ ] –ù–∞—Å—Ç—Ä–æ–π–∫–∏ `.env` –æ–±–Ω–æ–≤–ª–µ–Ω—ã (–∫–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è)
- [ ] Cron –∑–∞–¥–∞–Ω–∏–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ (–µ—Å–ª–∏ –Ω—É–∂–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è)
- [ ] Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

---

## –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ï—Å–ª–∏ –ø–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:

1. **–í—Å—ë –µ—â—ë –≤–∏–¥–∏—Ç–µ 350 —Ö–æ—Å—Ç–æ–≤ –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏**
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –∫–æ–¥ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω: `git log --oneline -1`
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ Docker –æ–±—Ä–∞–∑ –ø–µ—Ä–µ—Å–æ–±—Ä–∞–ª—Å—è: `docker compose build`
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏: –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å "–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏"

2. **–í–∏–¥–∏—Ç–µ 0 —Ö–æ—Å—Ç–æ–≤ –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏**
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –≤ Zabbix –µ—Å—Ç—å —Ö–æ—Å—Ç—ã —Å —à–∞–±–ª–æ–Ω–æ–º "VMware Hypervisor"
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–æ—á–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —à–∞–±–ª–æ–Ω–∞ –≤ Zabbix (–º–æ–∂–µ—Ç –æ—Ç–ª–∏—á–∞—Ç—å—Å—è)
   - –£–≤–µ–ª–∏—á—å—Ç–µ LOG_LEVEL=DEBUG –∏ –ø–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –∫–∞–∫–∏–µ —à–∞–±–ª–æ–Ω—ã –≤–∏–¥–∏—Ç –ø—Ä–æ–≥—Ä–∞–º–º–∞

3. **–°–µ—Ç–µ–≤—ã–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –≤—Å—ë –µ—â—ë –ø–æ–ø–∞–¥–∞—é—Ç –≤ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é**
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏–º–µ–Ω–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤ - –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –ø–∞—Ç—Ç–µ—Ä–Ω
   - –î–æ–±–∞–≤—å—Ç–µ —Å–≤–æ–π –ø–∞—Ç—Ç–µ—Ä–Ω –≤ NETWORK_DEVICE_PATTERNS –≤ sync.py
   - –ù–∞–ø–∏—à–∏—Ç–µ issue —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏ –∏–º–µ–Ω —É—Å—Ç—Ä–æ–π—Å—Ç–≤

---

**–í–µ—Ä—Å–∏—è:** 1.0.0-hotfix
**–î–∞—Ç–∞:** 2025-11-17
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** CRITICAL
**–°—Ç–∞—Ç—É—Å:** Ready for deployment
