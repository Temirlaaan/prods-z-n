# ğŸ”„ Workflow - Zabbix â†’ NetBox Sync

## ĞŸĞ¾Ğ»Ğ½Ğ¾Ğµ Ğ¾Ğ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‹ Ğ¿Ñ€Ğ¾Ğ³Ñ€Ğ°Ğ¼Ğ¼Ñ‹ ÑĞ¾ Ğ²ÑĞµĞ¼Ğ¸ Ğ½ÑĞ°Ğ½ÑĞ°Ğ¼Ğ¸

---

## ğŸ“‹ ĞĞ³Ğ»Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ

1. [ĞĞ±Ñ‰Ğ°Ñ ÑÑ…ĞµĞ¼Ğ° Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‹](#Ğ¾Ğ±Ñ‰Ğ°Ñ-ÑÑ…ĞµĞ¼Ğ°-Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‹)
2. [Ğ”ĞµÑ‚Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ workflow](#Ğ´ĞµÑ‚Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹-workflow)
3. [Ğ¤Ğ¸Ğ»ÑŒÑ‚Ñ€Ğ°Ñ†Ğ¸Ñ ÑƒÑÑ‚Ñ€Ğ¾Ğ¹ÑÑ‚Ğ²](#Ñ„Ğ¸Ğ»ÑŒÑ‚Ñ€Ğ°Ñ†Ğ¸Ñ-ÑƒÑÑ‚Ñ€Ğ¾Ğ¹ÑÑ‚Ğ²)
4. [ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğ¹ (Redis)](#Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ°-Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğ¹-redis)
5. [Ğ¡Ğ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ ÑƒÑÑ‚Ñ€Ğ¾Ğ¹ÑÑ‚Ğ²Ğ°](#ÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ-ÑƒÑÑ‚Ñ€Ğ¾Ğ¹ÑÑ‚Ğ²Ğ°)
6. [ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° decommissioning](#Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ°-decommissioning)
7. [Ğ’Ğ·Ğ°Ğ¸Ğ¼Ğ¾Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ğµ Ñ Ğ´Ñ€ÑƒĞ³Ğ¸Ğ¼Ğ¸ ÑĞ¸ÑÑ‚ĞµĞ¼Ğ°Ğ¼Ğ¸](#Ğ²Ğ·Ğ°Ğ¸Ğ¼Ğ¾Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ğµ-Ñ-Ğ´Ñ€ÑƒĞ³Ğ¸Ğ¼Ğ¸-ÑĞ¸ÑÑ‚ĞµĞ¼Ğ°Ğ¼Ğ¸)
8. [ĞŸĞ¾Ñ‚ĞµĞ½Ñ†Ğ¸Ğ°Ğ»ÑŒĞ½Ñ‹Ğµ Ğ¿Ñ€Ğ¾Ğ±Ğ»ĞµĞ¼Ñ‹](#Ğ¿Ğ¾Ñ‚ĞµĞ½Ñ†Ğ¸Ğ°Ğ»ÑŒĞ½Ñ‹Ğµ-Ğ¿Ñ€Ğ¾Ğ±Ğ»ĞµĞ¼Ñ‹)

---

## ĞĞ±Ñ‰Ğ°Ñ ÑÑ…ĞµĞ¼Ğ° Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Ğ—ĞĞŸĞ£Ğ¡Ğš Ğ¡Ğ˜ĞĞ¥Ğ ĞĞĞ˜Ğ—ĞĞ¦Ğ˜Ğ˜                         â”‚
â”‚                 (docker compose run sync-app)                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1. ĞŸĞĞ”ĞšĞ›Ğ®Ğ§Ğ•ĞĞ˜Ğ• Ğš Ğ¡Ğ•Ğ Ğ’Ğ˜Ğ¡ĞĞœ                                      â”‚
â”‚  âœ“ Zabbix API                                                   â”‚
â”‚  âœ“ NetBox API                                                   â”‚
â”‚  âœ“ Redis (Ğ¾Ğ¿Ñ†Ğ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾)                                          â”‚
â”‚  âœ“ Telegram Bot (Ğ¾Ğ¿Ñ†Ğ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾)                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  2. ĞŸĞĞ›Ğ£Ğ§Ğ•ĞĞ˜Ğ• Ğ¥ĞĞ¡Ğ¢ĞĞ’ Ğ˜Ğ— ZABBIX                                  â”‚
â”‚  â†’ Ğ—Ğ°Ğ¿Ñ€Ğ¾Ñ: host.get(selectParentTemplates, selectInventory)     â”‚
â”‚  â†’ ĞŸĞ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¾: Ğ’Ğ¡Ğ• Ñ…Ğ¾ÑÑ‚Ñ‹ (~568 ÑƒÑÑ‚Ñ€Ğ¾Ğ¹ÑÑ‚Ğ²)                         â”‚
â”‚     â€¢ 350 ÑĞµÑ€Ğ²ĞµÑ€Ğ¾Ğ² (VMware Hypervisor)                          â”‚
â”‚     â€¢ 218 ÑĞµÑ‚ĞµĞ²Ñ‹Ñ… ÑƒÑÑ‚Ñ€Ğ¾Ğ¹ÑÑ‚Ğ² (switches, routers, firewalls)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  3. Ğ¤Ğ˜Ğ›Ğ¬Ğ¢Ğ ĞĞ¦Ğ˜Ğ¯ (get_vmware_hosts)                               â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚ Ğ”Ğ»Ñ ĞºĞ°Ğ¶Ğ´Ğ¾Ğ³Ğ¾ Ñ…Ğ¾ÑÑ‚Ğ°:                                  â”‚       â”‚
â”‚  â”‚                                                      â”‚       â”‚
â”‚  â”‚ âŒ Ğ˜Ğ¡ĞšĞ›Ğ®Ğ§Ğ˜Ğ¢Ğ¬ ĞµÑĞ»Ğ¸ Ğ¸Ğ¼Ñ ÑĞ¾Ğ´ĞµÑ€Ğ¶Ğ¸Ñ‚:                      â”‚       â”‚
â”‚  â”‚    -sw\d, -rt\d, -fw\d, leaf-, spine-, edge-        â”‚       â”‚
â”‚  â”‚    mgmt-, cloud-, col-, \d+sw$                      â”‚       â”‚
â”‚  â”‚                                                      â”‚       â”‚
â”‚  â”‚ âŒ Ğ˜Ğ¡ĞšĞ›Ğ®Ğ§Ğ˜Ğ¢Ğ¬ ĞµÑĞ»Ğ¸ ĞĞ•Ğ¢ ÑˆĞ°Ğ±Ğ»Ğ¾Ğ½Ğ°:                       â”‚       â”‚
â”‚  â”‚    "VMware Hypervisor" (Ñ‚Ğ¾Ñ‡Ğ½Ğ¾Ğµ ÑĞ¾Ğ²Ğ¿Ğ°Ğ´ĞµĞ½Ğ¸Ğµ)          â”‚       â”‚
â”‚  â”‚                                                      â”‚       â”‚
â”‚  â”‚ âŒ Ğ˜Ğ¡ĞšĞ›Ğ®Ğ§Ğ˜Ğ¢Ğ¬ ĞµÑĞ»Ğ¸ ĞµÑÑ‚ÑŒ Ğ¸ÑĞºĞ»ÑÑ‡ĞµĞ½Ğ½Ñ‹Ğ¹ ÑˆĞ°Ğ±Ğ»Ğ¾Ğ½:           â”‚       â”‚
â”‚  â”‚    "Juniper by SNMP", "Template Net SNMP"           â”‚       â”‚
â”‚  â”‚                                                      â”‚       â”‚
â”‚  â”‚ âŒ Ğ˜Ğ¡ĞšĞ›Ğ®Ğ§Ğ˜Ğ¢Ğ¬ ĞµÑĞ»Ğ¸ Ğ² Ğ¸ÑĞºĞ»ÑÑ‡ĞµĞ½Ğ½Ğ¾Ğ¹ Ğ³Ñ€ÑƒĞ¿Ğ¿Ğµ:              â”‚       â”‚
â”‚  â”‚    "Network", "DataStore", "Virtual machines"       â”‚       â”‚
â”‚  â”‚                                                      â”‚       â”‚
â”‚  â”‚ âœ… Ğ’ĞšĞ›Ğ®Ğ§Ğ˜Ğ¢Ğ¬ Ğ² ÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ                          â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                                                                 â”‚
â”‚  ğŸ“Š Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚:                                                  â”‚
â”‚     â€¢ Ğ’ÑĞµĞ³Ğ¾ Ğ¸Ğ· Zabbix: 568                                      â”‚
â”‚     â€¢ Ğ˜ÑĞºĞ»ÑÑ‡ĞµĞ½Ğ¾ ÑĞµÑ‚ĞµĞ²Ñ‹Ñ…: 218                                    â”‚
â”‚     â€¢ Ğš ÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸: 350 ÑĞµÑ€Ğ²ĞµÑ€Ğ¾Ğ²                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  4. ĞŸĞ ĞĞ’Ğ•Ğ ĞšĞ Ğ˜Ğ—ĞœĞ•ĞĞ•ĞĞ˜Ğ™ Ğ§Ğ•Ğ Ğ•Ğ— REDIS                              â”‚
â”‚                                                                 â”‚
â”‚  Ğ”Ğ»Ñ ĞºĞ°Ğ¶Ğ´Ğ¾Ğ³Ğ¾ ÑĞµÑ€Ğ²ĞµÑ€Ğ° (350 ÑˆÑ‚ÑƒĞº):                                â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚ Ğ’Ñ‹Ñ‡Ğ¸ÑĞ»Ğ¸Ñ‚ÑŒ SHA-256 Ñ…ÑÑˆ:                            â”‚         â”‚
â”‚  â”‚   hash = sha256(hostid + name + ip + inventory)   â”‚         â”‚
â”‚  â”‚                                                    â”‚         â”‚
â”‚  â”‚ ĞŸĞ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ ÑÑ‚Ğ°Ñ€Ñ‹Ğ¹ Ñ…ÑÑˆ Ğ¸Ğ· Redis:                     â”‚         â”‚
â”‚  â”‚   old_hash = redis.get("zabbix_host:12345")       â”‚         â”‚
â”‚  â”‚                                                    â”‚         â”‚
â”‚  â”‚ Ğ¡Ñ€Ğ°Ğ²Ğ½Ğ¸Ñ‚ÑŒ:                                          â”‚         â”‚
â”‚  â”‚   âœ“ ĞĞµÑ‚ Ğ² Redis â†’ NEW (ÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ)          â”‚         â”‚
â”‚  â”‚   âœ“ hash â‰  old_hash â†’ CHANGED (ÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ)  â”‚         â”‚
â”‚  â”‚   âœ“ hash = old_hash â†’ SKIP (Ğ±ĞµĞ· Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğ¹)        â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚                                                                 â”‚
â”‚  ğŸ“Š Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚:                                                  â”‚
â”‚     â€¢ ĞĞ¾Ğ²Ñ‹Ñ…: 5                                                  â”‚
â”‚     â€¢ Ğ˜Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ½Ñ‹Ñ…: 10                                            â”‚
â”‚     â€¢ ĞŸÑ€Ğ¾Ğ¿ÑƒÑ‰ĞµĞ½Ğ¾ (Ğ±ĞµĞ· Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğ¹): 335                            â”‚
â”‚     â€¢ Ğ’ÑĞµĞ³Ğ¾ Ğº Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞµ: 15                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  5. Ğ¡Ğ˜ĞĞ¥Ğ ĞĞĞ˜Ğ—ĞĞ¦Ğ˜Ğ¯ ĞŸĞĞšĞ•Ğ¢ĞĞœĞ˜ (batch_size=50)                      â”‚
â”‚                                                                 â”‚
â”‚  Ğ”Ğ»Ñ ĞºĞ°Ğ¶Ğ´Ğ¾Ğ³Ğ¾ ÑƒÑÑ‚Ñ€Ğ¾Ğ¹ÑÑ‚Ğ²Ğ° (15 ÑˆÑ‚ÑƒĞº):                              â”‚
â”‚     â†’ sync_device(host_data)                                    â”‚
â”‚                                                                 â”‚
â”‚  Ğ¡Ğ¼. Ğ´ĞµÑ‚Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ workflow Ğ½Ğ¸Ğ¶Ğµ â†“                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  6. ĞŸĞ ĞĞ’Ğ•Ğ ĞšĞ DECOMMISSIONING                                    â”‚
â”‚     â†’ check_decommissioned_devices()                            â”‚
â”‚                                                                 â”‚
â”‚  Ğ¡Ğ¼. Ğ´ĞµÑ‚Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ workflow Ğ½Ğ¸Ğ¶Ğµ â†“                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  7. Ğ Ğ•Ğ—Ğ£Ğ›Ğ¬Ğ¢ĞĞ¢Ğ« Ğ˜ Ğ£Ğ’Ğ•Ğ”ĞĞœĞ›Ğ•ĞĞ˜Ğ¯                                    â”‚
â”‚  ğŸ“Š Ğ¡Ñ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ°:                                                 â”‚
â”‚     âœ“ Ğ£ÑĞ¿ĞµÑˆĞ½Ğ¾: 15                                               â”‚
â”‚     âœ— ĞÑˆĞ¸Ğ±Ğ¾Ğº: 0                                                 â”‚
â”‚     ğŸ”„ ĞŸĞµÑ€ĞµĞ¸Ğ¼ĞµĞ½Ğ¾Ğ²Ğ°Ğ½Ğ¾: 1                                         â”‚
â”‚     ğŸ—‘ Decommissioned: 2                                        â”‚
â”‚     â†©ï¸ Ğ’Ğ¾ÑÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¾: 1                                         â”‚
â”‚                                                                 â”‚
â”‚  ğŸ“± Telegram ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ğµ (ĞµÑĞ»Ğ¸ Ğ²ĞºĞ»ÑÑ‡ĞµĞ½Ğ¾)                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Ğ”ĞµÑ‚Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ workflow

### Ğ­Ğ¢ĞĞŸ 5: Ğ¡Ğ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ ÑƒÑÑ‚Ñ€Ğ¾Ğ¹ÑÑ‚Ğ²Ğ° (sync_device)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Ğ’Ğ¥ĞĞ”: host_data (Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ¸Ğ· Zabbix)                             â”‚
â”‚  {                                                              â”‚
â”‚    "hostid": "12345",                                           â”‚
â”‚    "host": "esx-srv-01",                                        â”‚
â”‚    "name": "esx-srv-01.domain.local",                           â”‚
â”‚    "status": "0",  # 0=active, 1=disabled                       â”‚
â”‚    "inventory": {                                               â”‚
â”‚      "vendor": "Dell Inc.",                                     â”‚
â”‚      "model": "PowerEdge R640",                                 â”‚
â”‚      "serialno_a": "ABC123",                                    â”‚
â”‚      "hardware": "Intel Xeon ...",                              â”‚
â”‚      "software_app_a": "128GB",                                 â”‚
â”‚      ...                                                        â”‚
â”‚    },                                                           â”‚
â”‚    "interfaces": [{"ip": "10.11.1.10"}]                         â”‚
â”‚  }                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ĞŸĞ ĞĞ’Ğ•Ğ ĞšĞ 1: Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ Ñ…Ğ¾ÑÑ‚Ğ° Ğ² Zabbix                              â”‚
â”‚                                                                 â”‚
â”‚  if status == '1' (disabled):                                   â”‚
â”‚     âš ï¸ Ğ¥Ğ¾ÑÑ‚ disabled Ğ² Zabbix â†’ ĞĞ• ÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ¸Ğ·Ğ¸Ñ€ÑƒĞµĞ¼               â”‚
â”‚     STOP                                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚ status == '0' (active)
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ĞŸĞ ĞĞ’Ğ•Ğ ĞšĞ 2: Ğ’Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ñ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…                                   â”‚
â”‚                                                                 â”‚
â”‚  âœ“ Ğ•ÑÑ‚ÑŒ Ğ»Ğ¸ primary IP?                                          â”‚
â”‚     âŒ ĞĞµÑ‚ â†’ ERROR, skip                                        â”‚
â”‚     âœ… Ğ”Ğ° â†’ Ğ¿Ñ€Ğ¾Ğ´Ğ¾Ğ»Ğ¶Ğ°ĞµĞ¼                                          â”‚
â”‚                                                                 â”‚
â”‚  âœ“ Ğ’Ğ°Ğ»Ğ¸Ğ´Ğ½Ñ‹Ğ¹ IP Ğ°Ğ´Ñ€ĞµÑ?                                           â”‚
â”‚     âŒ ĞĞµÑ‚ â†’ ERROR, skip                                        â”‚
â”‚     âœ… Ğ”Ğ° â†’ Ğ¿Ñ€Ğ¾Ğ´Ğ¾Ğ»Ğ¶Ğ°ĞµĞ¼                                          â”‚
â”‚                                                                 â”‚
â”‚  âœ“ Ğ•ÑÑ‚ÑŒ vendor Ğ² inventory?                                     â”‚
â”‚     âŒ ĞĞµÑ‚ â†’ vendor = "Unknown"                                 â”‚
â”‚     âœ… Ğ”Ğ° â†’ normalize_vendor()                                  â”‚
â”‚                                                                 â”‚
â”‚  âœ“ Ğ•ÑÑ‚ÑŒ model Ğ² inventory?                                      â”‚
â”‚     âŒ ĞĞµÑ‚ â†’ model = "Unknown"                                  â”‚
â”‚     âœ… Ğ”Ğ° â†’ normalize_model()                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Ğ¨ĞĞ“Ğ˜ 3-4: ĞĞ¿Ñ€ĞµĞ´ĞµĞ»ĞµĞ½Ğ¸Ğµ Site Ğ¸ Location                          â”‚
â”‚                                                                 â”‚
â”‚  IP: 10.11.1.10                                                 â”‚
â”‚  Subnet: 10.11 â†’ SITE_MAPPING["10.11"]                          â”‚
â”‚  â†’ Site: "DC Kabanbay-Batyr28"                                  â”‚
â”‚  â†’ Location: "city Astana street Kabanbay batyr 28"             â”‚
â”‚                                                                 â”‚
â”‚  Ğ•ÑĞ»Ğ¸ subnet Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½:                                         â”‚
â”‚     â†’ Site: DEFAULT_SITE ("DC Konaeva10")                       â”‚
â”‚     â†’ Location: "city Astana street Konaeva 10"                 â”‚
â”‚                                                                 â”‚
â”‚  âŒ Ğ•ÑĞ»Ğ¸ Site/Location Ğ½Ğµ ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒÑÑ‚ Ğ² NetBox:                  â”‚
â”‚     â†’ ERROR: "Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ¹Ñ‚Ğµ Site/Location Ğ²Ñ€ÑƒÑ‡Ğ½ÑƒÑ Ğ² NetBox"          â”‚
â”‚     â†’ SKIP ÑƒÑÑ‚Ñ€Ğ¾Ğ¹ÑÑ‚Ğ²Ğ¾                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Ğ¨ĞĞ“ 5: Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ Manufacturer                                   â”‚
â”‚                                                                 â”‚
â”‚  vendor = "Dell Inc." â†’ normalize â†’ "Dell"                      â”‚
â”‚                                                                 â”‚
â”‚  ĞŸĞ¾Ğ¸ÑĞº: netbox.dcim.manufacturers.get(name="Dell")              â”‚
â”‚  âŒ ĞĞµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½ â†’ CREATE:                                         â”‚
â”‚     {                                                           â”‚
â”‚       "name": "Dell",                                           â”‚
â”‚       "slug": "dell"                                            â”‚
â”‚     }                                                           â”‚
â”‚  âœ… ĞĞ°Ğ¹Ğ´ĞµĞ½ â†’ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµĞ¼ ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒÑÑ‰Ğ¸Ğ¹                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Ğ¨ĞĞ“ 6: Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ Device Type                                    â”‚
â”‚                                                                 â”‚
â”‚  model = "PowerEdge R640"                                       â”‚
â”‚  manufacturer = Dell (id=5)                                     â”‚
â”‚                                                                 â”‚
â”‚  U-height lookup:                                               â”‚
â”‚    U_HEIGHT_MAPPING["Dell PowerEdge R640"] = 1                  â”‚
â”‚                                                                 â”‚
â”‚  ĞŸĞ¾Ğ¸ÑĞº: netbox.dcim.device_types.get(                           â”‚
â”‚    model="PowerEdge R640",                                      â”‚
â”‚    manufacturer_id=5                                            â”‚
â”‚  )                                                              â”‚
â”‚                                                                 â”‚
â”‚  âŒ ĞĞµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½ â†’ CREATE:                                         â”‚
â”‚     {                                                           â”‚
â”‚       "manufacturer": 5,                                        â”‚
â”‚       "model": "PowerEdge R640",                                â”‚
â”‚       "slug": "poweredge-r640",                                 â”‚
â”‚       "u_height": 1                                             â”‚
â”‚     }                                                           â”‚
â”‚  âœ… ĞĞ°Ğ¹Ğ´ĞµĞ½ â†’ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµĞ¼ ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒÑÑ‰Ğ¸Ğ¹                            â”‚
â”‚                                                                 â”‚
â”‚  âš ï¸ Ğ•ÑĞ»Ğ¸ U-height ĞĞ• Ğ½Ğ°Ğ¹Ğ´ĞµĞ½ Ğ² Ğ¼Ğ°Ğ¿Ğ¿Ğ¸Ğ½Ğ³Ğµ:                         â”‚
â”‚     â†’ u_height = 2 (Ğ´ĞµÑ„Ğ¾Ğ»Ñ‚)                                     â”‚
â”‚     â†’ Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞµĞ¼ Ğ² stats['new_models'] Ğ´Ğ»Ñ Ñ€ÑƒÑ‡Ğ½Ğ¾Ğ¹ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ¸       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Ğ¨ĞĞ“ 7: ĞŸĞ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ğµ/Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ Device (FIX #1: Ğ¿Ğ¾ zabbix_hostid)    â”‚
â”‚                                                                 â”‚
â”‚  ĞŸĞ¾Ğ¸ÑĞº Ğ¿Ğ¾ zabbix_hostid (ĞĞ• Ğ¿Ğ¾ Ğ¸Ğ¼ĞµĞ½Ğ¸!):                         â”‚
â”‚    devices = netbox.dcim.devices.filter(                        â”‚
â”‚      cf_zabbix_hostid="12345"                                   â”‚
â”‚    )                                                            â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚ Ğ¡Ğ›Ğ£Ğ§ĞĞ™ A: Ğ£ÑÑ‚Ñ€Ğ¾Ğ¹ÑÑ‚Ğ²Ğ¾ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ğ¾                     â”‚          â”‚
â”‚  â”‚                                                   â”‚          â”‚
â”‚  â”‚ ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ¿ĞµÑ€ĞµĞ¸Ğ¼ĞµĞ½Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ:                          â”‚          â”‚
â”‚  â”‚   if device.name != host_name:                    â”‚          â”‚
â”‚  â”‚      âš ï¸ ĞŸĞµÑ€ĞµĞ¸Ğ¼ĞµĞ½Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ: old_name â†’ new_name       â”‚          â”‚
â”‚  â”‚      if DRY_RUN=false:                            â”‚          â”‚
â”‚  â”‚         device.name = new_name                    â”‚          â”‚
â”‚  â”‚         device.save()                             â”‚          â”‚
â”‚  â”‚      stats['renamed_hosts'].append(...)           â”‚          â”‚
â”‚  â”‚                                                   â”‚          â”‚
â”‚  â”‚ ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ²Ğ¾ÑÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ñ:                          â”‚          â”‚
â”‚  â”‚   if device.status == 'decommissioning':          â”‚          â”‚
â”‚  â”‚      âœ… Ğ¥Ğ¾ÑÑ‚ ÑĞ½Ğ¾Ğ²Ğ° Ğ°ĞºÑ‚Ğ¸Ğ²ĞµĞ½ Ğ² Zabbix               â”‚          â”‚
â”‚  â”‚      if DRY_RUN=false:                            â”‚          â”‚
â”‚  â”‚         device.status = 'active'                  â”‚          â”‚
â”‚  â”‚         device.custom_fields['decommissioned_date'] = None â”‚
â”‚  â”‚         device.save()                             â”‚          â”‚
â”‚  â”‚      stats['recovered_hosts'].append(...)         â”‚          â”‚
â”‚  â”‚                                                   â”‚          â”‚
â”‚  â”‚ â†’ UPDATE device                                   â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚ Ğ¡Ğ›Ğ£Ğ§ĞĞ™ B: Ğ£ÑÑ‚Ñ€Ğ¾Ğ¹ÑÑ‚Ğ²Ğ¾ ĞĞ• Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ğ¾                  â”‚          â”‚
â”‚  â”‚                                                   â”‚          â”‚
â”‚  â”‚ â†’ CREATE new device:                              â”‚          â”‚
â”‚  â”‚    {                                              â”‚          â”‚
â”‚  â”‚      "name": "esx-srv-01",                        â”‚          â”‚
â”‚  â”‚      "device_type": device_type_id,               â”‚          â”‚
â”‚  â”‚      "site": site_id,                             â”‚          â”‚
â”‚  â”‚      "location": location_id,                     â”‚          â”‚
â”‚  â”‚      "status": "active",                          â”‚          â”‚
â”‚  â”‚      "custom_fields": {                           â”‚          â”‚
â”‚  â”‚        "zabbix_hostid": "12345",                  â”‚          â”‚
â”‚  â”‚        "cpu_model": "Intel Xeon...",              â”‚          â”‚
â”‚  â”‚        "memory_size": "128GB",                    â”‚          â”‚
â”‚  â”‚        ...                                        â”‚          â”‚
â”‚  â”‚      }                                            â”‚          â”‚
â”‚  â”‚    }                                              â”‚          â”‚
â”‚  â”‚                                                   â”‚          â”‚
â”‚  â”‚ stats['new_hosts'].append(...)                    â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Ğ¨ĞĞ“ 8: ĞĞ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ¿Ğ¾Ğ»ĞµĞ¹ ÑƒÑÑ‚Ñ€Ğ¾Ğ¹ÑÑ‚Ğ²Ğ° (Ñ Ğ·Ğ°Ñ‰Ğ¸Ñ‚Ğ¾Ğ¹)                 â”‚
â”‚                                                                 â”‚
â”‚  PROTECTED_FIELDS = ["comments", "description", ...]            â”‚
â”‚  PROTECTED_CUSTOM_FIELDS = ["manual_notes", ...]                â”‚
â”‚                                                                 â”‚
â”‚  Ğ”Ğ»Ñ ĞºĞ°Ğ¶Ğ´Ğ¾Ğ³Ğ¾ Ğ¿Ğ¾Ğ»Ñ:                                              â”‚
â”‚    âœ“ Ğ•ÑĞ»Ğ¸ Ğ¿Ğ¾Ğ»Ğµ Ğ² PROTECTED_FIELDS â†’ ĞŸĞ ĞĞŸĞ£Ğ¡Ğ¢Ğ˜Ğ¢Ğ¬ (Ğ½Ğµ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ÑÑ‚ÑŒ)  â”‚
â”‚    âœ“ Ğ˜Ğ½Ğ°Ñ‡Ğµ â†’ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ Ğ¸Ğ· Zabbix                                 â”‚
â”‚                                                                 â”‚
â”‚  ĞĞ±Ğ½Ğ¾Ğ²Ğ»ÑĞµĞ¼Ñ‹Ğµ Ğ¿Ğ¾Ğ»Ñ:                                              â”‚
â”‚    â€¢ name (ĞµÑĞ»Ğ¸ Ğ¿ĞµÑ€ĞµĞ¸Ğ¼ĞµĞ½Ğ¾Ğ²Ğ°Ğ½Ğ¾)                                  â”‚
â”‚    â€¢ device_type (ĞµÑĞ»Ğ¸ Ğ¸Ğ·Ğ¼ĞµĞ½Ğ¸Ğ»Ğ°ÑÑŒ Ğ¼Ğ¾Ğ´ĞµĞ»ÑŒ)                       â”‚
â”‚    â€¢ site (ĞµÑĞ»Ğ¸ Ğ¸Ğ·Ğ¼ĞµĞ½Ğ¸Ğ»ÑÑ IP/subnet)                            â”‚
â”‚    â€¢ location (ĞµÑĞ»Ğ¸ Ğ¸Ğ·Ğ¼ĞµĞ½Ğ¸Ğ»ÑÑ site)                             â”‚
â”‚    â€¢ serial (serialno_a Ğ¸Ğ· inventory)                           â”‚
â”‚    â€¢ asset_tag (asset_tag Ğ¸Ğ· inventory)                         â”‚
â”‚                                                                 â”‚
â”‚  Custom fields (Ğ¸Ğ· ZABBIX_TO_NETBOX_MAPPING):                   â”‚
â”‚    â€¢ cpu_model = inventory['hardware']                          â”‚
â”‚    â€¢ memory_size = inventory['software_app_a']                  â”‚
â”‚    â€¢ os_name = inventory['os']                                  â”‚
â”‚    â€¢ os_version = inventory['os_short']                         â”‚
â”‚    â€¢ vsphere_cluster = inventory['alias']                       â”‚
â”‚    â€¢ rack_name = inventory['software_app_b']                    â”‚
â”‚    â€¢ rack_unit = inventory['location_lon']                      â”‚
â”‚    â€¢ last_sync = datetime.now()                                 â”‚
â”‚                                                                 â”‚
â”‚  âš ï¸ Ğ’ĞĞ–ĞĞ: Ğ—Ğ°Ñ‰Ğ¸Ñ‰ĞµĞ½Ğ½Ñ‹Ğµ Ğ¿Ğ¾Ğ»Ñ ĞĞ• Ğ¿ĞµÑ€ĞµĞ·Ğ°Ğ¿Ğ¸ÑÑ‹Ğ²Ğ°ÑÑ‚ÑÑ!                 â”‚
â”‚     Ğ•ÑĞ»Ğ¸ Ğ°Ğ´Ğ¼Ğ¸Ğ½ Ğ²Ñ€ÑƒÑ‡Ğ½ÑƒÑ Ğ¸Ğ·Ğ¼ĞµĞ½Ğ¸Ğ» comments Ğ² NetBox,               â”‚
â”‚     ÑÑ‚Ğ¾ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğµ ÑĞ¾Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑÑ!                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Ğ¨ĞĞ“ 9: ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° ĞºĞ¾Ğ½Ñ„Ğ»Ğ¸ĞºÑ‚Ğ¾Ğ² ÑÑ‚Ğ¾ĞµĞº (FIX #5)                      â”‚
â”‚                                                                 â”‚
â”‚  if CHECK_RACK_CONFLICTS = true:                                â”‚
â”‚                                                                 â”‚
â”‚    rack_name = inventory['software_app_b']  # "RACK-01"         â”‚
â”‚    rack_unit = inventory['location_lon']    # "10"              â”‚
â”‚                                                                 â”‚
â”‚    if rack_name and rack_unit:                                  â”‚
â”‚      ĞŸĞ¾Ğ¸ÑĞº ÑÑ‚Ğ¾Ğ¹ĞºĞ¸: netbox.dcim.racks.get(                       â”‚
â”‚        name=rack_name,                                          â”‚
â”‚        site_id=site_id                                          â”‚
â”‚      )                                                          â”‚
â”‚                                                                 â”‚
â”‚      if rack Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ğ°:                                           â”‚
â”‚        ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ¿Ğ¾Ğ·Ğ¸Ñ†Ğ¸Ğ¸ U:                                      â”‚
â”‚          devices_in_rack = netbox.dcim.devices.filter(          â”‚
â”‚            rack_id=rack.id,                                     â”‚
â”‚            position=rack_unit                                   â”‚
â”‚          )                                                      â”‚
â”‚                                                                 â”‚
â”‚          if ĞµÑÑ‚ÑŒ Ğ´Ñ€ÑƒĞ³Ğ¾Ğµ ÑƒÑÑ‚Ñ€Ğ¾Ğ¹ÑÑ‚Ğ²Ğ¾ Ğ½Ğ° ÑÑ‚Ğ¾Ğ¹ Ğ¿Ğ¾Ğ·Ğ¸Ñ†Ğ¸Ğ¸:             â”‚
â”‚            âš ï¸ ĞšĞĞĞ¤Ğ›Ğ˜ĞšĞ¢!                                         â”‚
â”‚            â†’ ĞĞ• ÑƒÑÑ‚Ğ°Ğ½Ğ°Ğ²Ğ»Ğ¸Ğ²Ğ°ĞµĞ¼ Ğ¿Ğ¾Ğ·Ğ¸Ñ†Ğ¸Ñ                           â”‚
â”‚            â†’ stats['rack_conflicts'].append(...)                â”‚
â”‚            â†’ Telegram ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ğµ                               â”‚
â”‚          else:                                                  â”‚
â”‚            âœ… ĞŸĞ¾Ğ·Ğ¸Ñ†Ğ¸Ñ ÑĞ²Ğ¾Ğ±Ğ¾Ğ´Ğ½Ğ°                                  â”‚
â”‚            â†’ device.rack = rack                                 â”‚
â”‚            â†’ device.position = rack_unit                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Ğ¨ĞĞ“ 10: Ğ¡Ğ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ IP Ğ°Ğ´Ñ€ĞµÑĞ° (FIX #3: Orphaned IPs)         â”‚
â”‚                                                                 â”‚
â”‚  primary_ip = "10.11.1.10"                                      â”‚
â”‚  ip_with_mask = "10.11.1.10/24"                                 â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚ ĞŸĞĞ”Ğ¨ĞĞ“ 1: ĞĞ¿Ñ€ĞµĞ´ĞµĞ»ĞµĞ½Ğ¸Ğµ Ğ¿Ñ€ĞµÑ„Ğ¸ĞºÑĞ°                 â”‚            â”‚
â”‚  â”‚                                                 â”‚            â”‚
â”‚  â”‚ ĞŸĞ¾Ğ¸ÑĞº prefix Ğ² NetBox:                          â”‚            â”‚
â”‚  â”‚   netbox.ipam.prefixes.filter(contains=ip)      â”‚            â”‚
â”‚  â”‚                                                 â”‚            â”‚
â”‚  â”‚ âœ… ĞĞ°Ğ¹Ğ´ĞµĞ½ â†’ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµĞ¼ prefix.prefix            â”‚            â”‚
â”‚  â”‚    ip_with_mask = "10.11.1.10/24"               â”‚            â”‚
â”‚  â”‚                                                 â”‚            â”‚
â”‚  â”‚ âŒ ĞĞµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½ â†’ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµĞ¼ /24 Ğ¿Ğ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ      â”‚            â”‚
â”‚  â”‚    ip_with_mask = "10.11.1.10/24"               â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚ ĞŸĞĞ”Ğ¨ĞĞ“ 2: ĞŸĞ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ğµ/Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ IP Ğ°Ğ´Ñ€ĞµÑĞ°          â”‚            â”‚
â”‚  â”‚                                                 â”‚            â”‚
â”‚  â”‚ ĞŸĞ¾Ğ¸ÑĞº: netbox.ipam.ip_addresses.get(            â”‚            â”‚
â”‚  â”‚   address=ip_with_mask                          â”‚            â”‚
â”‚  â”‚ )                                               â”‚            â”‚
â”‚  â”‚                                                 â”‚            â”‚
â”‚  â”‚ âŒ ĞĞµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½ â†’ CREATE:                          â”‚            â”‚
â”‚  â”‚    {                                            â”‚            â”‚
â”‚  â”‚      "address": "10.11.1.10/24",                â”‚            â”‚
â”‚  â”‚      "status": "active",                        â”‚            â”‚
â”‚  â”‚      "assigned_object_type": "dcim.interface",  â”‚            â”‚
â”‚  â”‚      "assigned_object_id": interface_id,        â”‚            â”‚
â”‚  â”‚      "dns_name": device.name                    â”‚            â”‚
â”‚  â”‚    }                                            â”‚            â”‚
â”‚  â”‚                                                 â”‚            â”‚
â”‚  â”‚ âœ… ĞĞ°Ğ¹Ğ´ĞµĞ½ â†’ UPDATE assigned_object              â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚ ĞŸĞĞ”Ğ¨ĞĞ“ 3: Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ Ğ¸Ğ½Ñ‚ĞµÑ€Ñ„ĞµĞ¹ÑĞ° (ĞµÑĞ»Ğ¸ Ğ½ÑƒĞ¶Ğ½Ğ¾)      â”‚            â”‚
â”‚  â”‚                                                 â”‚            â”‚
â”‚  â”‚ ĞŸĞ¾Ğ¸ÑĞº: netbox.dcim.interfaces.get(              â”‚            â”‚
â”‚  â”‚   device_id=device.id,                          â”‚            â”‚
â”‚  â”‚   name="Management"                             â”‚            â”‚
â”‚  â”‚ )                                               â”‚            â”‚
â”‚  â”‚                                                 â”‚            â”‚
â”‚  â”‚ âŒ ĞĞµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½ â†’ CREATE:                          â”‚            â”‚
â”‚  â”‚    {                                            â”‚            â”‚
â”‚  â”‚      "device": device.id,                       â”‚            â”‚
â”‚  â”‚      "name": "Management",                      â”‚            â”‚
â”‚  â”‚      "type": "other"                            â”‚            â”‚
â”‚  â”‚    }                                            â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚ ĞŸĞĞ”Ğ¨ĞĞ“ 4: Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ° primary IP                  â”‚            â”‚
â”‚  â”‚                                                 â”‚            â”‚
â”‚  â”‚ device.primary_ip4 = ip_address                 â”‚            â”‚
â”‚  â”‚ device.save()                                   â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚ ĞŸĞĞ”Ğ¨ĞĞ“ 5: ĞÑ‡Ğ¸ÑÑ‚ĞºĞ° ÑÑ‚Ğ°Ñ€Ğ¾Ğ³Ğ¾ IP (FIX #3)           â”‚            â”‚
â”‚  â”‚                                                 â”‚            â”‚
â”‚  â”‚ if ÑÑ‚Ğ°Ñ€Ñ‹Ğ¹ IP != Ğ½Ğ¾Ğ²Ñ‹Ğ¹ IP:                       â”‚            â”‚
â”‚  â”‚                                                 â”‚            â”‚
â”‚  â”‚   if ORPHANED_IP_ACTION == 'deprecated':        â”‚            â”‚
â”‚  â”‚      old_ip.status = 'deprecated'               â”‚            â”‚
â”‚  â”‚      old_ip.description = "Was used by ..."     â”‚            â”‚
â”‚  â”‚      old_ip.assigned_object = None              â”‚            â”‚
â”‚  â”‚      old_ip.save()                              â”‚            â”‚
â”‚  â”‚                                                 â”‚            â”‚
â”‚  â”‚   elif ORPHANED_IP_ACTION == 'delete':          â”‚            â”‚
â”‚  â”‚      old_ip.delete()                            â”‚            â”‚
â”‚  â”‚                                                 â”‚            â”‚
â”‚  â”‚   elif ORPHANED_IP_ACTION == 'keep':            â”‚            â”‚
â”‚  â”‚      # ĞĞ¸Ñ‡ĞµĞ³Ğ¾ Ğ½Ğµ Ğ´ĞµĞ»Ğ°ĞµĞ¼                         â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Ğ¨ĞĞ“ 11: Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğµ Ñ…ÑÑˆĞ° Ğ² Redis                                â”‚
â”‚                                                                 â”‚
â”‚  if Redis Ğ²ĞºĞ»ÑÑ‡ĞµĞ½:                                              â”‚
â”‚    hash = sha256(host_data)                                     â”‚
â”‚    redis.set("zabbix_host:12345", hash, ttl=86400)              â”‚
â”‚    redis.set("zabbix_host:data:12345", json(host_data))         â”‚
â”‚                                                                 â”‚
â”‚  stats['changed_hosts'].append(device.name)                     â”‚
â”‚                                                                 â”‚
â”‚  âœ… Ğ£Ğ¡Ğ¢Ğ ĞĞ™Ğ¡Ğ¢Ğ’Ğ Ğ¡Ğ˜ĞĞ¥Ğ ĞĞĞ˜Ğ—Ğ˜Ğ ĞĞ’ĞĞĞ                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### Ğ­Ğ¢ĞĞŸ 6: ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° decommissioning

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Ğ’Ğ¥ĞĞ”: ĞŸĞ¾ÑĞ»Ğµ ÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸ Ğ²ÑĞµÑ… ÑƒÑÑ‚Ñ€Ğ¾Ğ¹ÑÑ‚Ğ²                       â”‚
â”‚  Ğ¦ĞµĞ»ÑŒ: ĞĞ°Ğ¹Ñ‚Ğ¸ Ğ½ĞµĞ°ĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ğµ ÑƒÑÑ‚Ñ€Ğ¾Ğ¹ÑÑ‚Ğ²Ğ° Ğ¸ Ğ¿Ğ¾Ğ¼ĞµÑ‚Ğ¸Ñ‚ÑŒ Ğ¸Ñ…                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Ğ¨ĞĞ“ 1: ĞŸĞ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ğµ ÑĞ¿Ğ¸ÑĞºĞ° Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ñ… ÑĞµÑ€Ğ²ĞµÑ€Ğ¾Ğ² Ğ¸Ğ· Zabbix            â”‚
â”‚                                                                 â”‚
â”‚  active_host_ids = set()                                        â”‚
â”‚  for host in get_vmware_hosts():  # Ğ¢Ğ¾Ğ»ÑŒĞºĞ¾ ÑĞµÑ€Ğ²ĞµÑ€Ñ‹!             â”‚
â”‚      active_host_ids.add(host['hostid'])                        â”‚
â”‚                                                                 â”‚
â”‚  Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚: {12345, 12346, 12347, ...}  # 350 hostid            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Ğ¨ĞĞ“ 2: ĞŸĞ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ğµ Ğ²ÑĞµÑ… Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ñ… ÑƒÑÑ‚Ñ€Ğ¾Ğ¹ÑÑ‚Ğ² Ğ¸Ğ· NetBox              â”‚
â”‚                                                                 â”‚
â”‚  netbox_devices = netbox.dcim.devices.filter(                   â”‚
â”‚      cf_zabbix_hostid__n=False,  # zabbix_hostid ĞĞ• null        â”‚
â”‚      status='active'                                            â”‚
â”‚  )                                                              â”‚
â”‚                                                                 â”‚
â”‚  Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚: ~568 ÑƒÑÑ‚Ñ€Ğ¾Ğ¹ÑÑ‚Ğ² (350 ÑĞµÑ€Ğ²ĞµÑ€Ğ¾Ğ² + 218 ÑĞµÑ‚ĞµĞ²Ñ‹Ñ…)         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Ğ¨ĞĞ“ 3: Ğ¤Ğ˜Ğ›Ğ¬Ğ¢Ğ ĞĞ¦Ğ˜Ğ¯ - Ğ¸ÑĞºĞ»ÑÑ‡Ğ°ĞµĞ¼ ÑĞµÑ‚ĞµĞ²Ğ¾Ğµ Ğ¾Ğ±Ğ¾Ñ€ÑƒĞ´Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ             â”‚
â”‚                                                                 â”‚
â”‚  NETWORK_PATTERNS = ['-sw', '-rt', '-fw', 'leaf-', ...]         â”‚
â”‚                                                                 â”‚
â”‚  excluded_count = 0                                             â”‚
â”‚  checked_count = 0                                              â”‚
â”‚                                                                 â”‚
â”‚  for device in netbox_devices:                                  â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚    â”‚ ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ¸Ğ¼ĞµĞ½Ğ¸ ÑƒÑÑ‚Ñ€Ğ¾Ğ¹ÑÑ‚Ğ²Ğ°:                    â”‚           â”‚
â”‚    â”‚                                                â”‚           â”‚
â”‚    â”‚ if re.search(NETWORK_PATTERNS, device.name):   â”‚           â”‚
â”‚    â”‚    â­ ĞŸĞ ĞĞŸĞ£Ğ¡Ğ¢Ğ˜Ğ¢Ğ¬ (ÑĞµÑ‚ĞµĞ²Ğ¾Ğµ Ğ¾Ğ±Ğ¾Ñ€ÑƒĞ´Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ)        â”‚           â”‚
â”‚    â”‚    excluded_count += 1                         â”‚           â”‚
â”‚    â”‚    continue                                    â”‚           â”‚
â”‚    â”‚                                                â”‚           â”‚
â”‚    â”‚ âœ… Ğ­Ñ‚Ğ¾ ÑĞµÑ€Ğ²ĞµÑ€ â†’ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ Ğ´Ğ°Ğ»ÑŒÑˆĞµ               â”‚           â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                                                                 â”‚
â”‚  Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚:                                                     â”‚
â”‚    â€¢ Ğ˜ÑĞºĞ»ÑÑ‡ĞµĞ½Ğ¾: 218 ÑĞµÑ‚ĞµĞ²Ñ‹Ñ… ÑƒÑÑ‚Ñ€Ğ¾Ğ¹ÑÑ‚Ğ²                           â”‚
â”‚    â€¢ ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµÑ‚ÑÑ: 350 ÑĞµÑ€Ğ²ĞµÑ€Ğ¾Ğ²                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Ğ¨ĞĞ“ 4: ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° ĞºĞ°Ğ¶Ğ´Ğ¾Ğ³Ğ¾ ÑĞµÑ€Ğ²ĞµÑ€Ğ°                                â”‚
â”‚                                                                 â”‚
â”‚  for device in ÑĞµÑ€Ğ²ĞµÑ€Ñ‹ (350 ÑˆÑ‚ÑƒĞº):                              â”‚
â”‚                                                                 â”‚
â”‚    zabbix_hostid = device.custom_fields.get('zabbix_hostid')    â”‚
â”‚                                                                 â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚    â”‚ Ğ¡Ğ›Ğ£Ğ§ĞĞ™ A: hostid ĞµÑÑ‚ÑŒ Ğ² active_host_ids       â”‚            â”‚
â”‚    â”‚                                               â”‚            â”‚
â”‚    â”‚ âœ… Ğ¥Ğ¾ÑÑ‚ Ğ°ĞºÑ‚Ğ¸Ğ²ĞµĞ½ Ğ² Zabbix                      â”‚            â”‚
â”‚    â”‚ â†’ ĞĞ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ last_seen Ğ² Redis:                 â”‚            â”‚
â”‚    â”‚   redis.set("zabbix_host:lastseen:12345",    â”‚            â”‚
â”‚    â”‚             datetime.now())                   â”‚            â”‚
â”‚    â”‚                                               â”‚            â”‚
â”‚    â”‚ â†’ ĞĞ¸Ñ‡ĞµĞ³Ğ¾ Ğ½Ğµ Ğ´ĞµĞ»Ğ°ĞµĞ¼ Ñ ÑƒÑÑ‚Ñ€Ğ¾Ğ¹ÑÑ‚Ğ²Ğ¾Ğ¼              â”‚            â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                                                 â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚    â”‚ Ğ¡Ğ›Ğ£Ğ§ĞĞ™ B: hostid ĞĞ•Ğ¢ Ğ² active_host_ids        â”‚            â”‚
â”‚    â”‚                                               â”‚            â”‚
â”‚    â”‚ âŒ Ğ¥Ğ¾ÑÑ‚Ğ° ĞĞ•Ğ¢ Ğ² Zabbix (ÑƒĞ´Ğ°Ğ»ĞµĞ½/disabled)       â”‚            â”‚
â”‚    â”‚                                               â”‚            â”‚
â”‚    â”‚ â†’ ĞŸĞ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ last_seen Ğ¸Ğ· Redis:                â”‚            â”‚
â”‚    â”‚   last_seen = redis.get("...lastseen:12345")  â”‚            â”‚
â”‚    â”‚                                               â”‚            â”‚
â”‚    â”‚ if last_seen ĞĞ• Ğ½Ğ°Ğ¹Ğ´ĞµĞ½:                       â”‚            â”‚
â”‚    â”‚   â†’ ĞŸĞµÑ€Ğ²Ñ‹Ğ¹ Ñ€Ğ°Ğ· Ğ½Ğµ Ğ²Ğ¸Ğ´Ğ¸Ğ¼                       â”‚            â”‚
â”‚    â”‚   â†’ redis.set(..., datetime.now())            â”‚            â”‚
â”‚    â”‚   â†’ SKIP (Ğ´Ğ°ĞµĞ¼ 1 Ñ†Ğ¸ĞºĞ» Ğ½Ğ° Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºÑƒ)            â”‚            â”‚
â”‚    â”‚                                               â”‚            â”‚
â”‚    â”‚ if last_seen Ğ½Ğ°Ğ¹Ğ´ĞµĞ½:                          â”‚            â”‚
â”‚    â”‚   days_inactive = (now - last_seen).days      â”‚            â”‚
â”‚    â”‚                                               â”‚            â”‚
â”‚    â”‚   if days_inactive > DECOMMISSION_AFTER_DAYS: â”‚            â”‚
â”‚    â”‚      âš ï¸ ĞĞµĞ°ĞºÑ‚Ğ¸Ğ²ĞµĞ½ ÑĞ»Ğ¸ÑˆĞºĞ¾Ğ¼ Ğ´Ğ¾Ğ»Ğ³Ğ¾!              â”‚            â”‚
â”‚    â”‚                                               â”‚            â”‚
â”‚    â”‚      if DRY_RUN=false:                        â”‚            â”‚
â”‚    â”‚         device.status = 'decommissioning'     â”‚            â”‚
â”‚    â”‚         device.custom_fields['decommissioned_date'] = now â”‚
â”‚    â”‚         device.save()                         â”‚            â”‚
â”‚    â”‚                                               â”‚            â”‚
â”‚    â”‚      stats['decommissioned_hosts'].append(...)â”‚            â”‚
â”‚    â”‚      Telegram: "Ğ£ÑÑ‚Ñ€Ğ¾Ğ¹ÑÑ‚Ğ²Ğ¾ X decommissioned"  â”‚            â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                                                 â”‚
â”‚  Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚: 2 ÑĞµÑ€Ğ²ĞµÑ€Ğ° Ğ¿Ğ¾Ğ¼ĞµÑ‡ĞµĞ½Ñ‹ ĞºĞ°Ğº decommissioning              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Ğ¨ĞĞ“ 5: ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ñ„Ğ¸Ğ·Ğ¸Ñ‡ĞµÑĞºĞ¾Ğ³Ğ¾ ÑƒĞ´Ğ°Ğ»ĞµĞ½Ğ¸Ñ (FIX #2)                  â”‚
â”‚                                                                 â”‚
â”‚  if ENABLE_PHYSICAL_DELETION = true:                            â”‚
â”‚                                                                 â”‚
â”‚    decom_devices = netbox.dcim.devices.filter(                  â”‚
â”‚        status='decommissioning'                                 â”‚
â”‚    )                                                            â”‚
â”‚                                                                 â”‚
â”‚    for device in decom_devices:                                 â”‚
â”‚                                                                 â”‚
â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚      â”‚ ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ°: ÑÑ‚Ğ¾ ÑĞµÑ‚ĞµĞ²Ğ¾Ğµ ÑƒÑÑ‚Ñ€Ğ¾Ğ¹ÑÑ‚Ğ²Ğ¾?          â”‚            â”‚
â”‚      â”‚                                             â”‚            â”‚
â”‚      â”‚ if re.search(NETWORK_PATTERNS, device.name):â”‚            â”‚
â”‚      â”‚    â­ ĞŸĞ ĞĞŸĞ£Ğ¡Ğ¢Ğ˜Ğ¢Ğ¬ (Ğ½Ğµ ÑƒĞ´Ğ°Ğ»ÑĞµĞ¼ ÑĞµÑ‚ĞµĞ²Ğ¾Ğµ!)      â”‚            â”‚
â”‚      â”‚    continue                                 â”‚            â”‚
â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                                                 â”‚
â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚      â”‚ ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ°: ÑĞºĞ¾Ğ»ÑŒĞºĞ¾ Ğ´Ğ½ĞµĞ¹ Ğ² decommissioning?   â”‚            â”‚
â”‚      â”‚                                             â”‚            â”‚
â”‚      â”‚ decom_date = device.custom_fields['decommissioned_date']â”‚
â”‚      â”‚ days_in_decom = (now - decom_date).days     â”‚            â”‚
â”‚      â”‚                                             â”‚            â”‚
â”‚      â”‚ if days_in_decom > DELETE_AFTER_DECOMMISSION_DAYS: â”‚    â”‚
â”‚      â”‚    âŒ Ğ¡Ğ»Ğ¸ÑˆĞºĞ¾Ğ¼ Ğ´Ğ¾Ğ»Ğ³Ğ¾ Ğ² decommissioning       â”‚            â”‚
â”‚      â”‚                                             â”‚            â”‚
â”‚      â”‚    if DRY_RUN=false:                        â”‚            â”‚
â”‚      â”‚       device_name = device.name             â”‚            â”‚
â”‚      â”‚       device.delete()  # Ğ¤Ğ˜Ğ—Ğ˜Ğ§Ğ•Ğ¡ĞšĞĞ• Ğ£Ğ”ĞĞ›Ğ•ĞĞ˜Ğ•â”‚            â”‚
â”‚      â”‚                                             â”‚            â”‚
â”‚      â”‚    stats['deleted_hosts'].append(...)       â”‚            â”‚
â”‚      â”‚    Telegram: "âš ï¸ Ğ£ÑÑ‚Ñ€Ğ¾Ğ¹ÑÑ‚Ğ²Ğ¾ X Ğ£Ğ”ĞĞ›Ğ•ĞĞ!"     â”‚            â”‚
â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                                                 â”‚
â”‚  âš ï¸ Ğ’ĞĞ˜ĞœĞĞĞ˜Ğ•: Ğ¤Ğ¸Ğ·Ğ¸Ñ‡ĞµÑĞºĞ¾Ğµ ÑƒĞ´Ğ°Ğ»ĞµĞ½Ğ¸Ğµ ĞĞ•ĞĞ‘Ğ ĞĞ¢Ğ˜ĞœĞ!                   â”‚
â”‚     Ğ ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´ÑƒĞµÑ‚ÑÑ ENABLE_PHYSICAL_DELETION=false                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Ğ¤Ğ¸Ğ»ÑŒÑ‚Ñ€Ğ°Ñ†Ğ¸Ñ ÑƒÑÑ‚Ñ€Ğ¾Ğ¹ÑÑ‚Ğ²

### Ğ”ĞµÑ‚Ğ°Ğ»ÑŒĞ½Ğ°Ñ ÑÑ…ĞµĞ¼Ğ° Ñ„Ğ¸Ğ»ÑŒÑ‚Ñ€Ğ°Ñ†Ğ¸Ğ¸

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Ğ’Ğ¥ĞĞ”: Ğ’Ğ¡Ğ• Ñ…Ğ¾ÑÑ‚Ñ‹ Ğ¸Ğ· Zabbix (~568 ÑƒÑÑ‚Ñ€Ğ¾Ğ¹ÑÑ‚Ğ²)                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â–¼                 â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚  350 ÑĞµÑ€Ğ²ĞµÑ€Ğ¾Ğ²   â”‚   â”‚ 218 ÑĞµÑ‚ĞµĞ²Ñ‹Ñ…     â”‚
         â”‚  VMware         â”‚   â”‚ switches/routersâ”‚
         â”‚  Hypervisor     â”‚   â”‚ firewalls       â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚                 â”‚
                    â”‚                 â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚  Ğ¤Ğ˜Ğ›Ğ¬Ğ¢Ğ  1: ĞŸĞ°Ñ‚Ñ‚ĞµÑ€Ğ½Ñ‹ Ğ¸Ğ¼ĞµĞ½            â”‚
          â”‚  (ĞŸĞ Ğ˜ĞĞ Ğ˜Ğ¢Ğ•Ğ¢ - Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ÑĞµÑ‚ÑÑ Ğ¿ĞµÑ€Ğ²Ñ‹Ğ¼!)  â”‚
          â”‚                                     â”‚
          â”‚  Regex Ğ¿Ğ°Ñ‚Ñ‚ĞµÑ€Ğ½Ñ‹:                    â”‚
          â”‚  â€¢ -sw\d   â†’ switches               â”‚
          â”‚  â€¢ -rt\d   â†’ routers                â”‚
          â”‚  â€¢ -fw\d   â†’ firewalls              â”‚
          â”‚  â€¢ leaf-   â†’ leaf switches          â”‚
          â”‚  â€¢ spine-  â†’ spine switches         â”‚
          â”‚  â€¢ edge-   â†’ edge devices           â”‚
          â”‚  â€¢ mgmt-   â†’ management             â”‚
          â”‚  â€¢ cloud-  â†’ cloud infrastructure   â”‚
          â”‚  â€¢ \d+sw$  â†’ ends with sw           â”‚
          â”‚                                     â”‚
          â”‚  ĞŸÑ€Ğ¸Ğ¼ĞµÑ€Ñ‹:                           â”‚
          â”‚  âŒ leaf-sw01-ast-dc01              â”‚
          â”‚  âŒ edge-rt01-alm-dc01              â”‚
          â”‚  âŒ mgmt-ac-sw01                    â”‚
          â”‚  âŒ 5900sw                           â”‚
          â”‚  âœ… esx-srv-01 (ÑĞµÑ€Ğ²ĞµÑ€)             â”‚
          â”‚  âœ… vcenter-01 (ÑĞµÑ€Ğ²ĞµÑ€)             â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚  Ğ¤Ğ˜Ğ›Ğ¬Ğ¢Ğ  2: Ğ¨Ğ°Ğ±Ğ»Ğ¾Ğ½Ñ‹ Zabbix         â”‚
          â”‚  (Ñ‚Ğ¾Ñ‡Ğ½Ğ¾Ğµ ÑĞ¾Ğ²Ğ¿Ğ°Ğ´ĞµĞ½Ğ¸Ğµ)              â”‚
          â”‚                                   â”‚
          â”‚  Ğ’ĞºĞ»ÑÑ‡Ğ°ĞµĞ¼Ñ‹Ğµ ÑˆĞ°Ğ±Ğ»Ğ¾Ğ½Ñ‹:              â”‚
          â”‚  âœ… "VMware Hypervisor"            â”‚
          â”‚                                   â”‚
          â”‚  ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ°:                        â”‚
          â”‚  for template in host.templates:  â”‚
          â”‚    if template.name.lower() ==    â”‚
          â”‚       "vmware hypervisor":        â”‚
          â”‚      âœ… Ğ’ĞšĞ›Ğ®Ğ§Ğ˜Ğ¢Ğ¬                   â”‚
          â”‚                                   â”‚
          â”‚  Ğ•ÑĞ»Ğ¸ ÑˆĞ°Ğ±Ğ»Ğ¾Ğ½Ğ° Ğ½ĞµÑ‚:                â”‚
          â”‚  âŒ Ğ˜Ğ¡ĞšĞ›Ğ®Ğ§Ğ˜Ğ¢Ğ¬                      â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚  Ğ¤Ğ˜Ğ›Ğ¬Ğ¢Ğ  3: Ğ˜ÑĞºĞ»ÑÑ‡ĞµĞ½Ğ½Ñ‹Ğµ ÑˆĞ°Ğ±Ğ»Ğ¾Ğ½Ñ‹    â”‚
          â”‚                                   â”‚
          â”‚  âŒ "Juniper by SNMP"              â”‚
          â”‚  âŒ "Template Net SNMP"            â”‚
          â”‚  âŒ "Template Module Generic SNMP" â”‚
          â”‚                                   â”‚
          â”‚  Ğ•ÑĞ»Ğ¸ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½ â†’ Ğ˜Ğ¡ĞšĞ›Ğ®Ğ§Ğ˜Ğ¢Ğ¬          â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚  Ğ¤Ğ˜Ğ›Ğ¬Ğ¢Ğ  4: Ğ˜ÑĞºĞ»ÑÑ‡ĞµĞ½Ğ½Ñ‹Ğµ Ğ³Ñ€ÑƒĞ¿Ğ¿Ñ‹     â”‚
          â”‚                                   â”‚
          â”‚  âŒ "Network"                      â”‚
          â”‚  âŒ "DataStore"                    â”‚
          â”‚  âŒ "Virtual machines"             â”‚
          â”‚                                   â”‚
          â”‚  Ğ•ÑĞ»Ğ¸ Ğ² Ğ³Ñ€ÑƒĞ¿Ğ¿Ğµ â†’ Ğ˜Ğ¡ĞšĞ›Ğ®Ğ§Ğ˜Ğ¢Ğ¬        â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚  Ğ Ğ•Ğ—Ğ£Ğ›Ğ¬Ğ¢ĞĞ¢:         â”‚
         â”‚  350 ÑĞµÑ€Ğ²ĞµÑ€Ğ¾Ğ²       â”‚
         â”‚  Ğ´Ğ»Ñ ÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸  â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğ¹ (Redis)

### ĞĞ»Ğ³Ğ¾Ñ€Ğ¸Ñ‚Ğ¼ Ğ¾Ğ¿Ñ€ĞµĞ´ĞµĞ»ĞµĞ½Ğ¸Ñ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğ¹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Ğ”Ğ»Ñ ĞºĞ°Ğ¶Ğ´Ğ¾Ğ³Ğ¾ Ñ…Ğ¾ÑÑ‚Ğ° Ğ¸Ğ· 350 ÑĞµÑ€Ğ²ĞµÑ€Ğ¾Ğ²:                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Ğ¨ĞĞ“ 1: Ğ¤Ğ¾Ñ€Ğ¼Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ´Ğ»Ñ Ñ…ÑÑˆĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ                     â”‚
â”‚                                                                 â”‚
â”‚  data = {                                                       â”‚
â”‚    "hostid": host['hostid'],                                    â”‚
â”‚    "name": host['name'],                                        â”‚
â”‚    "status": host['status'],                                    â”‚
â”‚    "ip": primary_ip,                                            â”‚
â”‚    "inventory": {                                               â”‚
â”‚      "vendor": inventory['vendor'],                             â”‚
â”‚      "model": inventory['model'],                               â”‚
â”‚      "serialno_a": inventory['serialno_a'],                     â”‚
â”‚      "hardware": inventory['hardware'],                         â”‚
â”‚      "software_app_a": inventory['software_app_a'],             â”‚
â”‚      ...                                                        â”‚
â”‚    }                                                            â”‚
â”‚  }                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Ğ¨ĞĞ“ 2: Ğ’Ñ‹Ñ‡Ğ¸ÑĞ»ĞµĞ½Ğ¸Ğµ SHA-256 Ñ…ÑÑˆĞ°                                 â”‚
â”‚                                                                 â”‚
â”‚  data_str = json.dumps(data, sort_keys=True)                    â”‚
â”‚  current_hash = sha256(data_str).hexdigest()                    â”‚
â”‚                                                                 â”‚
â”‚  ĞŸÑ€Ğ¸Ğ¼ĞµÑ€:                                                        â”‚
â”‚  current_hash = "a3f5d8e9c2b1..."                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Ğ¨ĞĞ“ 3: ĞŸĞ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ğµ ÑÑ‚Ğ°Ñ€Ğ¾Ğ³Ğ¾ Ñ…ÑÑˆĞ° Ğ¸Ğ· Redis                         â”‚
â”‚                                                                 â”‚
â”‚  redis_key = "zabbix_host:12345"                                â”‚
â”‚  old_hash = redis.get(redis_key)                                â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚ Ğ¡Ğ›Ğ£Ğ§ĞĞ™ A: old_hash = None                       â”‚           â”‚
â”‚  â”‚                                                  â”‚           â”‚
â”‚  â”‚ â†’ Ğ¥Ğ¾ÑÑ‚ ĞĞĞ’Ğ«Ğ™ (Ğ¿ĞµÑ€Ğ²Ğ°Ñ ÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ)             â”‚           â”‚
â”‚  â”‚ â†’ Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ² new_hosts[]                         â”‚           â”‚
â”‚  â”‚ â†’ Ğ‘ÑƒĞ´ĞµÑ‚ ÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½                          â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚ Ğ¡Ğ›Ğ£Ğ§ĞĞ™ B: old_hash != current_hash               â”‚           â”‚
â”‚  â”‚                                                  â”‚           â”‚
â”‚  â”‚ â†’ Ğ¥Ğ¾ÑÑ‚ Ğ˜Ğ—ĞœĞ•ĞĞ˜Ğ›Ğ¡Ğ¯                                 â”‚           â”‚
â”‚  â”‚                                                  â”‚           â”‚
â”‚  â”‚ Ğ”ĞµÑ‚Ğ°Ğ»ÑŒĞ½Ğ¾Ğµ ÑÑ€Ğ°Ğ²Ğ½ĞµĞ½Ğ¸Ğµ (Ğ´Ğ»Ñ Ğ»Ğ¾Ğ³Ğ¾Ğ²):                â”‚           â”‚
â”‚  â”‚   old_data = redis.get("zabbix_host:data:12345")â”‚           â”‚
â”‚  â”‚   changes = compare(old_data, new_data)          â”‚           â”‚
â”‚  â”‚                                                  â”‚           â”‚
â”‚  â”‚   ĞŸÑ€Ğ¸Ğ¼ĞµÑ€Ñ‹ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğ¹:                             â”‚           â”‚
â”‚  â”‚   â€¢ IP: 10.11.1.10 â†’ 10.11.1.20                  â”‚           â”‚
â”‚  â”‚   â€¢ Memory: 64GB â†’ 128GB                         â”‚           â”‚
â”‚  â”‚   â€¢ Model: R640 â†’ R650                           â”‚           â”‚
â”‚  â”‚                                                  â”‚           â”‚
â”‚  â”‚ â†’ Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ² changed_hosts[]                     â”‚           â”‚
â”‚  â”‚ â†’ Ğ‘ÑƒĞ´ĞµÑ‚ ÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½                          â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚ Ğ¡Ğ›Ğ£Ğ§ĞĞ™ C: old_hash == current_hash               â”‚           â”‚
â”‚  â”‚                                                  â”‚           â”‚
â”‚  â”‚ â†’ Ğ¥Ğ¾ÑÑ‚ Ğ‘Ğ•Ğ— Ğ˜Ğ—ĞœĞ•ĞĞ•ĞĞ˜Ğ™                             â”‚           â”‚
â”‚  â”‚ â†’ Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ² skipped[]                           â”‚           â”‚
â”‚  â”‚ â†’ ĞĞ• Ğ±ÑƒĞ´ĞµÑ‚ ÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½ (ÑĞºĞ¾Ğ½Ğ¾Ğ¼Ğ¸Ğ¼ Ğ²Ñ€ĞµĞ¼Ñ!)     â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Ğ Ğ•Ğ—Ğ£Ğ›Ğ¬Ğ¢ĞĞ¢:                                                     â”‚
â”‚  â€¢ new_hosts: 5 ÑƒÑÑ‚Ñ€Ğ¾Ğ¹ÑÑ‚Ğ² (Ğ±ÑƒĞ´ÑƒÑ‚ ÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ñ‹)              â”‚
â”‚  â€¢ changed_hosts: 10 ÑƒÑÑ‚Ñ€Ğ¾Ğ¹ÑÑ‚Ğ² (Ğ±ÑƒĞ´ÑƒÑ‚ ÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ñ‹)         â”‚
â”‚  â€¢ skipped: 335 ÑƒÑÑ‚Ñ€Ğ¾Ğ¹ÑÑ‚Ğ² (Ğ¿Ñ€Ğ¾Ğ¿ÑƒÑ‰ĞµĞ½Ñ‹)                           â”‚
â”‚                                                                 â”‚
â”‚  Ğ˜Ñ‚Ğ¾Ğ³Ğ¾ Ğº Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞµ: 15 ÑƒÑÑ‚Ñ€Ğ¾Ğ¹ÑÑ‚Ğ²                                â”‚
â”‚  Ğ­ĞºĞ¾Ğ½Ğ¾Ğ¼Ğ¸Ñ Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ¸: ~95% ÑƒÑÑ‚Ñ€Ğ¾Ğ¹ÑÑ‚Ğ² Ğ¿Ñ€Ğ¾Ğ¿ÑƒÑ‰ĞµĞ½Ğ¾!                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Ğ§Ñ‚Ğ¾ Ğ²Ğ»Ğ¸ÑĞµÑ‚ Ğ½Ğ° Ñ…ÑÑˆ (Ñ‚Ñ€Ğ¸Ğ³Ğ³ĞµÑ€Ñ‹ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğ¹)?

Ğ˜Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğµ Ğ»ÑĞ±Ğ¾Ğ³Ğ¾ Ğ¸Ğ· ÑÑ‚Ğ¸Ñ… Ğ¿Ğ¾Ğ»ĞµĞ¹ Ğ²Ñ‹Ğ·Ğ¾Ğ²ĞµÑ‚ ÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ:

âœ… **ĞÑĞ½Ğ¾Ğ²Ğ½Ñ‹Ğµ Ğ¿Ğ¾Ğ»Ñ:**
- Ğ˜Ğ¼Ñ Ñ…Ğ¾ÑÑ‚Ğ° (`name`)
- Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ Ğ² Zabbix (`status`)
- Primary IP Ğ°Ğ´Ñ€ĞµÑ

âœ… **Inventory Ğ¿Ğ¾Ğ»Ñ:**
- Vendor (Ğ¿Ñ€Ğ¾Ğ¸Ğ·Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ÑŒ)
- Model (Ğ¼Ğ¾Ğ´ĞµĞ»ÑŒ)
- Serial number
- Asset tag
- CPU model (`hardware`)
- Memory size (`software_app_a`)
- OS name/version
- vSphere cluster (`alias`)
- Rack name (`software_app_b`)
- Rack position (`location_lon`)

âŒ **ĞĞ• Ğ²Ğ»Ğ¸ÑĞµÑ‚ Ğ½Ğ° Ñ…ÑÑˆ:**
- Ğ—Ğ°Ñ‰Ğ¸Ñ‰ĞµĞ½Ğ½Ñ‹Ğµ Ğ¿Ğ¾Ğ»Ñ (`PROTECTED_FIELDS`)
- ĞšĞ¾Ğ¼Ğ¼ĞµĞ½Ñ‚Ğ°Ñ€Ğ¸Ğ¸
- Ğ¢ĞµĞ³Ğ¸ Ğ² NetBox
- Custom fields Ğ½Ğµ Ğ¸Ğ· Ğ¼Ğ°Ğ¿Ğ¿Ğ¸Ğ½Ğ³Ğ°

---

## Ğ’Ğ·Ğ°Ğ¸Ğ¼Ğ¾Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ğµ Ñ Ğ´Ñ€ÑƒĞ³Ğ¸Ğ¼Ğ¸ ÑĞ¸ÑÑ‚ĞµĞ¼Ğ°Ğ¼Ğ¸

### Ğ¡Ñ…ĞµĞ¼Ğ° Ğ²Ğ·Ğ°Ğ¸Ğ¼Ğ¾Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ñ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Ğ’ĞĞ¨Ğ Ğ˜ĞĞ¤Ğ ĞĞ¡Ğ¢Ğ Ğ£ĞšĞ¢Ğ£Ğ Ğ                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ZABBIX     â”‚         â”‚    NETBOX    â”‚         â”‚    REDIS     â”‚
â”‚              â”‚         â”‚              â”‚         â”‚              â”‚
â”‚ â€¢ 350 ÑĞµÑ€Ğ²ĞµÑ€Ğ¾Ğ²â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â€¢ Devices    â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â€¢ ĞšÑÑˆ Ñ…ÑÑˆĞµĞ¹  â”‚
â”‚   VMware     â”‚         â”‚ â€¢ IPs        â”‚         â”‚ â€¢ Last seen  â”‚
â”‚   Hypervisor â”‚         â”‚ â€¢ Interfaces â”‚         â”‚              â”‚
â”‚              â”‚         â”‚ â€¢ Racks      â”‚         â”‚              â”‚
â”‚ â€¢ 218 ÑĞµÑ‚ĞµĞ²Ñ‹Ñ…â”‚         â”‚              â”‚         â”‚              â”‚
â”‚   ÑƒÑÑ‚Ñ€Ğ¾Ğ¹ÑÑ‚Ğ²  â”‚         â”‚              â”‚         â”‚              â”‚
â”‚   (switches, â”‚         â”‚              â”‚         â”‚              â”‚
â”‚    routers)  â”‚         â”‚              â”‚         â”‚              â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                        â”‚                        â”‚
       â”‚ API                    â”‚ API                    â”‚ API
       â”‚                        â”‚                        â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          ĞšĞĞĞ¢Ğ•Ğ™ĞĞ•Ğ  1: Server Sync (Ğ­Ğ¢Ğ ĞŸĞ ĞĞ“Ğ ĞĞœĞœĞ)         â”‚
â”‚                                                           â”‚
â”‚  Ğ—Ğ°Ğ´Ğ°Ñ‡Ğ°: Ğ¡Ğ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ğ¢ĞĞ›Ğ¬ĞšĞ ÑĞµÑ€Ğ²ĞµÑ€Ğ¾Ğ²                    â”‚
â”‚  Ğ¨Ğ°Ğ±Ğ»Ğ¾Ğ½: VMware Hypervisor                                â”‚
â”‚  Ğ§Ğ°ÑÑ‚Ğ¾Ñ‚Ğ°: ĞšĞ°Ğ¶Ğ´Ñ‹Ğµ 2 Ğ´Ğ½Ñ (cron)                             â”‚
â”‚                                                           â”‚
â”‚  Ğ§Ñ‚Ğ¾ Ğ´ĞµĞ»Ğ°ĞµÑ‚:                                              â”‚
â”‚  âœ… Ğ¡Ğ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ¸Ğ·Ğ¸Ñ€ÑƒĞµÑ‚ 350 ÑĞµÑ€Ğ²ĞµÑ€Ğ¾Ğ²                            â”‚
â”‚  âŒ Ğ˜Ğ“ĞĞĞ Ğ˜Ğ Ğ£Ğ•Ğ¢ 218 ÑĞµÑ‚ĞµĞ²Ñ‹Ñ… ÑƒÑÑ‚Ñ€Ğ¾Ğ¹ÑÑ‚Ğ²                       â”‚
â”‚  âœ… Decommissioning Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ´Ğ»Ñ ÑĞµÑ€Ğ²ĞµÑ€Ğ¾Ğ²                    â”‚
â”‚  âŒ ĞĞ• Ğ¢Ğ ĞĞ“ĞĞ•Ğ¢ ÑĞµÑ‚ĞµĞ²Ğ¾Ğµ Ğ¾Ğ±Ğ¾Ñ€ÑƒĞ´Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          ĞšĞĞĞ¢Ğ•Ğ™ĞĞ•Ğ  2: Network Sync (Ğ’ĞĞ¨Ğ Ğ¡Ğ˜Ğ¡Ğ¢Ğ•ĞœĞ)         â”‚
â”‚                                                           â”‚
â”‚  Ğ—Ğ°Ğ´Ğ°Ñ‡Ğ°: Ğ¡Ğ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ğ¢ĞĞ›Ğ¬ĞšĞ ÑĞµÑ‚ĞµĞ²Ğ¾Ğ³Ğ¾ Ğ¾Ğ±Ğ¾Ñ€ÑƒĞ´Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ       â”‚
â”‚  Ğ£ÑÑ‚Ñ€Ğ¾Ğ¹ÑÑ‚Ğ²Ğ°: Switches, Routers, Firewalls                 â”‚
â”‚  Ğ§Ğ°ÑÑ‚Ğ¾Ñ‚Ğ°: ???                                             â”‚
â”‚                                                           â”‚
â”‚  Ğ§Ñ‚Ğ¾ Ğ´ĞµĞ»Ğ°ĞµÑ‚:                                              â”‚
â”‚  âœ… Ğ¡Ğ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ¸Ğ·Ğ¸Ñ€ÑƒĞµÑ‚ 218 ÑĞµÑ‚ĞµĞ²Ñ‹Ñ… ÑƒÑÑ‚Ñ€Ğ¾Ğ¹ÑÑ‚Ğ²                   â”‚
â”‚  âœ… Ğ£ÑÑ‚Ğ°Ğ½Ğ°Ğ²Ğ»Ğ¸Ğ²Ğ°ĞµÑ‚ zabbix_hostid Ğ´Ğ»Ñ ÑĞµÑ‚ĞµĞ²Ñ‹Ñ… ÑƒÑÑ‚Ñ€Ğ¾Ğ¹ÑÑ‚Ğ²      â”‚
â”‚  âœ… Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ÑĞµÑ‚ lifecycle ÑĞµÑ‚ĞµĞ²Ğ¾Ğ³Ğ¾ Ğ¾Ğ±Ğ¾Ñ€ÑƒĞ´Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ              â”‚
â”‚  âŒ ĞĞ• Ğ¢Ğ ĞĞ“ĞĞ•Ğ¢ ÑĞµÑ€Ğ²ĞµÑ€Ñ‹                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                         â–¼
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚   TELEGRAM     â”‚
                â”‚   (ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ñ)â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### âš ï¸ Ğ’ĞĞ–ĞĞ: Ğ Ğ°Ğ·Ğ´ĞµĞ»ĞµĞ½Ğ¸Ğµ Ğ¾Ñ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ĞµĞ½Ğ½Ğ¾ÑÑ‚Ğ¸

| ĞÑĞ¿ĞµĞºÑ‚ | ĞšĞ¾Ğ½Ñ‚ĞµĞ¹Ğ½ĞµÑ€ 1 (Server Sync) | ĞšĞ¾Ğ½Ñ‚ĞµĞ¹Ğ½ĞµÑ€ 2 (Network Sync) |
|--------|---------------------------|----------------------------|
| **Ğ£ÑÑ‚Ñ€Ğ¾Ğ¹ÑÑ‚Ğ²Ğ°** | 350 ÑĞµÑ€Ğ²ĞµÑ€Ğ¾Ğ² VMware Hypervisor | 218 ÑĞµÑ‚ĞµĞ²Ñ‹Ñ… ÑƒÑÑ‚Ñ€Ğ¾Ğ¹ÑÑ‚Ğ² |
| **Ğ¤Ğ¸Ğ»ÑŒÑ‚Ñ€** | Ğ¨Ğ°Ğ±Ğ»Ğ¾Ğ½ "VMware Hypervisor" | Ğ¨Ğ°Ğ±Ğ»Ğ¾Ğ½Ñ‹ switches/routers |
| **Decommissioning** | âœ… Ğ¢Ğ¾Ğ»ÑŒĞºĞ¾ Ğ´Ğ»Ñ ÑĞµÑ€Ğ²ĞµÑ€Ğ¾Ğ² | âœ… Ğ¢Ğ¾Ğ»ÑŒĞºĞ¾ Ğ´Ğ»Ñ ÑĞµÑ‚ĞµĞ²Ğ¾Ğ³Ğ¾ |
| **Custom fields** | âœ… zabbix_hostid, cpu_model, etc | âœ… zabbix_hostid, port_count, etc |
| **Ğ—Ğ°Ñ‰Ğ¸Ñ‚Ğ°** | âŒ Ğ˜Ğ“ĞĞĞ Ğ˜Ğ Ğ£Ğ•Ğ¢ ÑĞµÑ‚ĞµĞ²Ñ‹Ğµ ÑƒÑÑ‚Ñ€Ğ¾Ğ¹ÑÑ‚Ğ²Ğ° | âŒ Ğ˜Ğ“ĞĞĞ Ğ˜Ğ Ğ£Ğ•Ğ¢ ÑĞµÑ€Ğ²ĞµÑ€Ñ‹ |

### ĞŸĞ¾Ñ‚ĞµĞ½Ñ†Ğ¸Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ ĞºĞ¾Ğ½Ñ„Ğ»Ğ¸ĞºÑ‚ Ğ¸ Ñ€ĞµÑˆĞµĞ½Ğ¸Ğµ

**ĞŸÑ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ°:**
- ĞĞ±Ğ° ĞºĞ¾Ğ½Ñ‚ĞµĞ¹Ğ½ĞµÑ€Ğ° ÑƒÑÑ‚Ğ°Ğ½Ğ°Ğ²Ğ»Ğ¸Ğ²Ğ°ÑÑ‚ `zabbix_hostid` Ğ² custom fields
- ĞšĞ¾Ğ½Ñ‚ĞµĞ¹Ğ½ĞµÑ€ 1 Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ°ĞµÑ‚ Ğ’Ğ¡Ğ• ÑƒÑÑ‚Ñ€Ğ¾Ğ¹ÑÑ‚Ğ²Ğ° Ñ `zabbix_hostid` Ğ¸Ğ· NetBox
- Ğ‘ĞµĞ· Ñ„Ğ¸Ğ»ÑŒÑ‚Ñ€Ğ°Ñ†Ğ¸Ğ¸ Ğ¾Ğ½ Ğ¿Ñ‹Ñ‚Ğ°ĞµÑ‚ÑÑ ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ÑÑ‚ÑŒ ÑĞµÑ‚ĞµĞ²Ñ‹Ğ¼Ğ¸ ÑƒÑÑ‚Ñ€Ğ¾Ğ¹ÑÑ‚Ğ²Ğ°Ğ¼Ğ¸

**Ğ ĞµÑˆĞµĞ½Ğ¸Ğµ (Ñ€ĞµĞ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ğ½Ğ¾):**
```python
# Ğ’ check_decommissioned_devices():
for device in netbox_devices:
    # Ğ¤Ğ˜Ğ›Ğ¬Ğ¢Ğ : ĞŸÑ€Ğ¾Ğ¿ÑƒÑĞºĞ°ĞµĞ¼ ÑĞµÑ‚ĞµĞ²Ğ¾Ğµ Ğ¾Ğ±Ğ¾Ñ€ÑƒĞ´Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ
    if re.search(NETWORK_PATTERNS, device.name):
        continue  # â† ĞĞ• Ñ‚Ñ€Ğ¾Ğ³Ğ°ĞµĞ¼!

    # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ Ğ¢ĞĞ›Ğ¬ĞšĞ ÑĞµÑ€Ğ²ĞµÑ€Ñ‹
    if zabbix_hostid not in active_host_ids:
        mark_as_decommissioning(device)
```

---

## ĞŸĞ¾Ñ‚ĞµĞ½Ñ†Ğ¸Ğ°Ğ»ÑŒĞ½Ñ‹Ğµ Ğ¿Ñ€Ğ¾Ğ±Ğ»ĞµĞ¼Ñ‹

### 1. âš ï¸ ĞšĞ¾Ğ½Ñ„Ğ»Ğ¸ĞºÑ‚ Ğ¿Ñ€Ğ¸ Ğ¾Ğ´Ğ½Ğ¾Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ½Ğ¾Ğ¼ Ğ·Ğ°Ğ¿ÑƒÑĞºĞµ

**Ğ¡Ñ†ĞµĞ½Ğ°Ñ€Ğ¸Ğ¹:**
- ĞšĞ¾Ğ½Ñ‚ĞµĞ¹Ğ½ĞµÑ€ 1 (Server Sync) Ğ·Ğ°Ğ¿ÑƒÑĞºĞ°ĞµÑ‚ÑÑ
- ĞĞ´Ğ½Ğ¾Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ½Ğ¾ Ğ·Ğ°Ğ¿ÑƒÑĞºĞ°ĞµÑ‚ÑÑ ĞšĞ¾Ğ½Ñ‚ĞµĞ¹Ğ½ĞµÑ€ 2 (Network Sync)
- ĞĞ±Ğ° Ğ¿Ñ‹Ñ‚Ğ°ÑÑ‚ÑÑ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ Ğ¾Ğ´Ğ½Ğ¾ ÑƒÑÑ‚Ñ€Ğ¾Ğ¹ÑÑ‚Ğ²Ğ¾

**Ğ Ğ¸ÑĞº:** Race condition Ğ² NetBox

**Ğ ĞµÑˆĞµĞ½Ğ¸Ğµ:**
- Ğ Ğ°Ğ·Ğ½ĞµÑÑ‚Ğ¸ Ğ¿Ğ¾ Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ¸ Ğ·Ğ°Ğ¿ÑƒÑĞºĞ¸ (cron)
- ĞšĞ¾Ğ½Ñ‚ĞµĞ¹Ğ½ĞµÑ€ 1: ĞºĞ°Ğ¶Ğ´Ñ‹Ğµ 2 Ğ´Ğ½Ñ Ğ² 02:00
- ĞšĞ¾Ğ½Ñ‚ĞµĞ¹Ğ½ĞµÑ€ 2: ĞºĞ°Ğ¶Ğ´Ñ‹Ğµ 2 Ğ´Ğ½Ñ Ğ² 04:00 (ÑĞ´Ğ²Ğ¸Ğ³ 2 Ñ‡Ğ°ÑĞ°)

---

### 2. âš ï¸ Ğ¡ĞµÑ‚ĞµĞ²Ğ¾Ğµ ÑƒÑÑ‚Ñ€Ğ¾Ğ¹ÑÑ‚Ğ²Ğ¾ Ğ½Ğ°Ğ·Ğ²Ğ°Ğ½Ğ¾ ĞºĞ°Ğº ÑĞµÑ€Ğ²ĞµÑ€

**Ğ¡Ñ†ĞµĞ½Ğ°Ñ€Ğ¸Ğ¹:**
```
Ğ£ÑÑ‚Ñ€Ğ¾Ğ¹ÑÑ‚Ğ²Ğ¾: "server-backup-01"
Ğ ĞµĞ°Ğ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ: Ğ­Ñ‚Ğ¾ switch!
ĞŸÑ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ°: ĞĞµ Ğ¿Ğ¾Ğ¿Ğ°Ğ´ĞµÑ‚ Ğ¿Ğ¾Ğ´ Ğ¿Ğ°Ñ‚Ñ‚ĞµÑ€Ğ½ -sw, -rt, -fw
```

**Ğ Ğ¸ÑĞº:** Ğ¡ĞµÑ‚ĞµĞ²Ğ¾Ğµ ÑƒÑÑ‚Ñ€Ğ¾Ğ¹ÑÑ‚Ğ²Ğ¾ Ğ¼Ğ¾Ğ¶ĞµÑ‚ Ğ±Ñ‹Ñ‚ÑŒ Ğ¾ÑˆĞ¸Ğ±Ğ¾Ñ‡Ğ½Ğ¾ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°Ğ½Ğ¾ ĞºĞ°Ğº ÑĞµÑ€Ğ²ĞµÑ€

**Ğ ĞµÑˆĞµĞ½Ğ¸Ğµ:**
1. **Ğ˜Ğ¼ĞµĞ½Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ:** ĞŸÑ€Ğ¸Ğ´ĞµÑ€Ğ¶Ğ¸Ğ²Ğ°Ğ¹Ñ‚ĞµÑÑŒ ĞºĞ¾Ğ½Ğ²ĞµĞ½Ñ†Ğ¸Ğ¸:
   - Ğ¡ĞµÑ€Ğ²ĞµÑ€Ñ‹: `esx-*`, `vcenter-*`, `srv-*`
   - Switches: `*-sw*`, `leaf-*`, `spine-*`
   - Routers: `*-rt*`
   - Firewalls: `*-fw*`

2. **Ğ”Ğ¾Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ°Ñ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ°:** Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ² config.py:
```python
# ĞŸÑ€Ğ¸Ğ½ÑƒĞ´Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾Ğµ Ğ²ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğµ (Ğ±ĞµĞ»Ñ‹Ğ¹ ÑĞ¿Ğ¸ÑĞ¾Ğº)
FORCE_SERVER_PATTERNS = ['^esx-', '^vcenter-', '^srv-']

# ĞŸÑ€Ğ¸Ğ½ÑƒĞ´Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾Ğµ Ğ¸ÑĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğµ (Ñ‡ĞµÑ€Ğ½Ñ‹Ğ¹ ÑĞ¿Ğ¸ÑĞ¾Ğº)
FORCE_EXCLUDE_PATTERNS = ['backup-switch', 'mgmt-']
```

---

### 3. âš ï¸ ĞĞ³Ñ€ĞµÑÑĞ¸Ğ²Ğ½Ñ‹Ğµ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ decommissioning

**Ğ’Ğ°ÑˆĞ¸ Ñ‚ĞµĞºÑƒÑ‰Ğ¸Ğµ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸:**
```bash
DECOMMISSION_AFTER_DAYS=1  # â† ĞĞŸĞĞ¡ĞĞ!
DELETE_AFTER_DECOMMISSION_DAYS=2  # â† ĞĞŸĞĞ¡ĞĞ!
```

**Ğ¡Ñ†ĞµĞ½Ğ°Ñ€Ğ¸Ğ¹:**
- Zabbix Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ½Ğ¾ Ğ½ĞµĞ´Ğ¾ÑÑ‚ÑƒĞ¿ĞµĞ½ (2 Ğ´Ğ½Ñ ÑĞ±Ğ¾Ğ¹)
- Redis Ğ¿Ğ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµÑ‚ Ñ‡Ñ‚Ğ¾ Ñ…Ğ¾ÑÑ‚Ñ‹ Ğ½Ğµ Ğ²Ğ¸Ğ´Ğ½Ñ‹ 2 Ğ´Ğ½Ñ
- ĞŸÑ€Ğ¾Ğ³Ñ€Ğ°Ğ¼Ğ¼Ğ° Ğ¿Ğ¾Ğ¼ĞµÑ‡Ğ°ĞµÑ‚ Ğ’Ğ¡Ğ• 350 ÑĞµÑ€Ğ²ĞµÑ€Ğ¾Ğ² ĞºĞ°Ğº decommissioning!

**Ğ Ğ¸ÑĞº:** ĞœĞ°ÑÑĞ¾Ğ²Ñ‹Ğ¹ false positive

**Ğ ĞµÑˆĞµĞ½Ğ¸Ğµ:**
```bash
# Ğ‘ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ñ‹Ğµ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸:
DECOMMISSION_AFTER_DAYS=30  # 30 Ğ´Ğ½ĞµĞ¹
DELETE_AFTER_DECOMMISSION_DAYS=90  # 90 Ğ´Ğ½ĞµĞ¹
ENABLE_PHYSICAL_DELETION=false  # ĞÑ‚ĞºĞ»ÑÑ‡ĞµĞ½Ğ¾!
```

**Workflow Ğ¿Ñ€Ğ¸ ÑĞ±Ğ¾Ğµ Zabbix:**
```
Ğ”ĞµĞ½ÑŒ 1: Zabbix Ğ½ĞµĞ´Ğ¾ÑÑ‚ÑƒĞ¿ĞµĞ½ â†’ last_seen Ğ½Ğµ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ÑĞµÑ‚ÑÑ
Ğ”ĞµĞ½ÑŒ 2: last_seen = 2 Ğ´Ğ½Ñ Ğ½Ğ°Ğ·Ğ°Ğ´ â†’ ĞĞ¸Ñ‡ĞµĞ³Ğ¾ Ğ½Ğµ Ğ¿Ñ€Ğ¾Ğ¸ÑÑ…Ğ¾Ğ´Ğ¸Ñ‚ (Ğ¿Ğ¾Ñ€Ğ¾Ğ³ 30 Ğ´Ğ½ĞµĞ¹)
Ğ”ĞµĞ½ÑŒ 3: Zabbix Ğ²Ğ¾ÑÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½ â†’ last_seen Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ÑĞµÑ‚ÑÑ â†’ Ğ’ÑĞµ ĞĞš
```

---

### 4. âš ï¸ Redis ÑƒĞ¿Ğ°Ğ»/Ğ¾Ñ‡Ğ¸Ñ‰ĞµĞ½

**Ğ¡Ñ†ĞµĞ½Ğ°Ñ€Ğ¸Ğ¹:**
- Redis ĞºĞ¾Ğ½Ñ‚ĞµĞ¹Ğ½ĞµÑ€ Ğ¿ĞµÑ€ĞµĞ·Ğ°Ğ¿ÑƒÑ‰ĞµĞ½
- Ğ’ÑĞµ Ñ…ÑÑˆĞ¸ Ğ¿Ğ¾Ñ‚ĞµÑ€ÑĞ½Ñ‹
- `redis.get(key)` Ğ²Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚ `None`

**Ğ§Ñ‚Ğ¾ Ğ¿Ñ€Ğ¾Ğ¸Ğ·Ğ¾Ğ¹Ğ´ĞµÑ‚:**
```python
old_hash = redis.get(key)  # â†’ None
# ĞŸÑ€Ğ¾Ğ³Ñ€Ğ°Ğ¼Ğ¼Ğ° Ğ´ÑƒĞ¼Ğ°ĞµÑ‚: Ğ²ÑĞµ Ñ…Ğ¾ÑÑ‚Ñ‹ ĞĞĞ’Ğ«Ğ•!
# â†’ ĞŸĞ¾Ğ¼ĞµÑ‚Ğ¸Ñ‚ Ğ’Ğ¡Ğ• 350 ÑĞµÑ€Ğ²ĞµÑ€Ğ¾Ğ² Ğ´Ğ»Ñ ÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸
```

**ĞŸĞ¾ÑĞ»ĞµĞ´ÑÑ‚Ğ²Ğ¸Ñ:**
- âœ… Ğ’ÑĞµ ÑƒÑÑ‚Ñ€Ğ¾Ğ¹ÑÑ‚Ğ²Ğ° ÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ¸Ğ·Ğ¸Ñ€ÑƒÑÑ‚ÑÑ (Ğ´Ğ¾Ğ»Ğ³Ğ¾, Ğ½Ğ¾ Ğ½Ğµ ĞºÑ€Ğ¸Ñ‚Ğ¸Ñ‡Ğ½Ğ¾)
- âœ… Ğ”Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ¾Ğ±Ğ½Ğ¾Ğ²ÑÑ‚ÑÑ ĞºĞ¾Ñ€Ñ€ĞµĞºÑ‚Ğ½Ğ¾
- âš ï¸ ĞŸĞµÑ€Ğ²Ñ‹Ğ¹ Ğ·Ğ°Ğ¿ÑƒÑĞº Ğ·Ğ°Ğ¹Ğ¼ĞµÑ‚ ~30-60 Ğ¼Ğ¸Ğ½ÑƒÑ‚ Ğ²Ğ¼ĞµÑÑ‚Ğ¾ 5 Ğ¼Ğ¸Ğ½ÑƒÑ‚

**Ğ ĞµÑˆĞµĞ½Ğ¸Ğµ:**
- Redis Ñ persistence (RDB/AOF)
- Ğ ĞµĞ³ÑƒĞ»ÑÑ€Ğ½Ñ‹Ğµ backup Redis
- Ğ˜Ğ»Ğ¸ ÑĞ¼Ğ¸Ñ€Ğ¸Ñ‚ÑŒÑÑ Ñ Ğ´Ğ¾Ğ»Ğ³Ğ¸Ğ¼ Ğ¿ĞµÑ€Ğ²Ñ‹Ğ¼ Ğ·Ğ°Ğ¿ÑƒÑĞºĞ¾Ğ¼

---

### 5. âš ï¸ ĞŸĞµÑ€ĞµĞ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ğµ Redis

**Ğ¡Ñ†ĞµĞ½Ğ°Ñ€Ğ¸Ğ¹:**
- 350 ÑĞµÑ€Ğ²ĞµÑ€Ğ¾Ğ² Ã— 2 ĞºĞ»ÑÑ‡Ğ° (hash + data) = 700 ĞºĞ»ÑÑ‡ĞµĞ¹
- ĞšĞ°Ğ¶Ğ´Ñ‹Ğ¹ data â‰ˆ 2KB
- Ğ˜Ñ‚Ğ¾Ğ³Ğ¾: ~1.4 MB (Ğ½Ğµ Ğ¿Ñ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ°)

**ĞĞ:**
- TTL = 86400 (24 Ñ‡Ğ°ÑĞ°)
- Ğ•ÑĞ»Ğ¸ ÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ ĞºĞ°Ğ¶Ğ´Ñ‹Ğµ 2 Ğ´Ğ½Ñ, ĞºĞ»ÑÑ‡Ğ¸ ÑƒÑÑ‚Ğ°Ñ€ĞµÑÑ‚!

**Ğ Ğ¸ÑĞº:** ĞŸÑ€Ğ¸ ÑĞ»ĞµĞ´ÑƒÑÑ‰ĞµĞ¼ Ğ·Ğ°Ğ¿ÑƒÑĞºĞµ Ğ²ÑĞµ Ñ…ÑÑˆĞ¸ expired â†’ Ğ²ÑĞµ Ñ…Ğ¾ÑÑ‚Ñ‹ "Ğ½Ğ¾Ğ²Ñ‹Ğµ"

**Ğ ĞµÑˆĞµĞ½Ğ¸Ğµ:**
```bash
# Ğ’ .env:
REDIS_TTL=259200  # 3 Ğ´Ğ½Ñ (Ğ±Ğ¾Ğ»ÑŒÑˆĞµ Ñ‡ĞµĞ¼ Ğ¸Ğ½Ñ‚ĞµÑ€Ğ²Ğ°Ğ» ÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸)
```

**ĞŸÑ€Ğ°Ğ²Ğ¸Ğ»Ğ¾:** `REDIS_TTL > Ğ¸Ğ½Ñ‚ĞµÑ€Ğ²Ğ°Ğ»_ÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸ Ã— 1.5`

---

### 6. âš ï¸ Orphaned IPs Ğ½Ğ°ĞºĞ°Ğ¿Ğ»Ğ¸Ğ²Ğ°ÑÑ‚ÑÑ

**Ğ¡Ñ†ĞµĞ½Ğ°Ñ€Ğ¸Ğ¹:**
- Ğ¡ĞµÑ€Ğ²ĞµÑ€ Ğ¼ĞµĞ½ÑĞµÑ‚ IP: 10.11.1.10 â†’ 10.11.1.20
- Ğ¡Ñ‚Ğ°Ñ€Ñ‹Ğ¹ IP 10.11.1.10 Ğ¿Ğ¾Ğ¼ĞµÑ‡Ğ°ĞµÑ‚ÑÑ `deprecated`
- Ğ§ĞµÑ€ĞµĞ· Ğ³Ğ¾Ğ´: 1000 deprecated IP Ğ² NetBox

**ĞŸÑ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ°:** Ğ—Ğ°Ğ¼ÑƒÑĞ¾Ñ€Ğ¸Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ±Ğ°Ğ·Ñ‹

**Ğ ĞµÑˆĞµĞ½Ğ¸Ğµ:**
```bash
# Ğ’ .env Ğ²Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ ÑÑ‚Ñ€Ğ°Ñ‚ĞµĞ³Ğ¸Ñ:

# Ğ’Ğ°Ñ€Ğ¸Ğ°Ğ½Ñ‚ 1: Ğ£Ğ´Ğ°Ğ»ÑÑ‚ÑŒ ÑÑ‚Ğ°Ñ€Ñ‹Ğµ IP (Ğ°Ğ³Ñ€ĞµÑÑĞ¸Ğ²Ğ½Ğ¾)
ORPHANED_IP_ACTION=delete

# Ğ’Ğ°Ñ€Ğ¸Ğ°Ğ½Ñ‚ 2: ĞŸĞ¾Ğ¼ĞµÑ‡Ğ°Ñ‚ÑŒ deprecated (Ğ¿Ğ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ)
ORPHANED_IP_ACTION=deprecated

# Ğ’Ğ°Ñ€Ğ¸Ğ°Ğ½Ñ‚ 3: ĞĞµ Ñ‚Ñ€Ğ¾Ğ³Ğ°Ñ‚ÑŒ (Ğ´Ğ»Ñ Ğ°ÑƒĞ´Ğ¸Ñ‚Ğ°)
ORPHANED_IP_ACTION=keep
```

**Ğ ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´Ğ°Ñ†Ğ¸Ñ + Ğ¿ĞµÑ€Ğ¸Ğ¾Ğ´Ğ¸Ñ‡ĞµÑĞºĞ°Ñ Ğ¾Ñ‡Ğ¸ÑÑ‚ĞºĞ°:**
```bash
# Ğ¡ĞºÑ€Ğ¸Ğ¿Ñ‚ Ğ´Ğ»Ñ Ğ¾Ñ‡Ğ¸ÑÑ‚ĞºĞ¸ ÑÑ‚Ğ°Ñ€Ñ‹Ñ… deprecated IP:
netbox.ipam.ip_addresses.filter(
    status='deprecated',
    last_updated__lt='2024-01-01'  # Ğ¡Ñ‚Ğ°Ñ€ÑˆĞµ Ğ³Ğ¾Ğ´Ğ°
).delete()
```

---

### 7. âš ï¸ Ğ—Ğ°Ñ‰Ğ¸Ñ‰ĞµĞ½Ğ½Ñ‹Ğµ Ğ¿Ğ¾Ğ»Ñ Ğ¿ĞµÑ€ĞµĞ·Ğ°Ğ¿Ğ¸ÑÑ‹Ğ²Ğ°ÑÑ‚ÑÑ

**Ğ¡Ñ†ĞµĞ½Ğ°Ñ€Ğ¸Ğ¹:**
- ĞĞ´Ğ¼Ğ¸Ğ½ Ğ²Ñ€ÑƒÑ‡Ğ½ÑƒÑ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ¸Ğ» `comments` Ğ² NetBox
- ĞŸÑ€Ğ¾Ğ³Ñ€Ğ°Ğ¼Ğ¼Ğ° ÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ¸Ğ·Ğ¸Ñ€ÑƒĞµÑ‚ ÑƒÑÑ‚Ñ€Ğ¾Ğ¹ÑÑ‚Ğ²Ğ¾
- `comments` Ğ¿ĞµÑ€ĞµĞ·Ğ°Ğ¿Ğ¸ÑÑ‹Ğ²Ğ°ĞµÑ‚ÑÑ Ğ¿ÑƒÑÑ‚Ñ‹Ğ¼ Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸ĞµĞ¼ Ğ¸Ğ· Zabbix

**ĞŸÑ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ°:** ĞŸĞ¾Ñ‚ĞµÑ€Ñ Ñ€ÑƒÑ‡Ğ½Ñ‹Ñ… Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğ¹

**Ğ ĞµÑˆĞµĞ½Ğ¸Ğµ (Ñ€ĞµĞ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ğ½Ğ¾):**
```bash
# Ğ’ .env:
PROTECTED_FIELDS=comments,description,tags
PROTECTED_CUSTOM_FIELDS=manual_notes,warranty_end

# Ğ­Ñ‚Ğ¸ Ğ¿Ğ¾Ğ»Ñ ĞĞ• Ğ±ÑƒĞ´ÑƒÑ‚ Ğ¿ĞµÑ€ĞµĞ·Ğ°Ğ¿Ğ¸ÑĞ°Ğ½Ñ‹!
```

---

### 8. âš ï¸ Rack conflicts Ğ½Ğµ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ°Ñ‚Ñ‹Ğ²Ğ°ÑÑ‚ÑÑ

**Ğ¡Ñ†ĞµĞ½Ğ°Ñ€Ğ¸Ğ¹:**
- Zabbix: Server A â†’ Rack-01, U10
- Zabbix: Server B â†’ Rack-01, U10 (Ñ‚Ğ° Ğ¶Ğµ Ğ¿Ğ¾Ğ·Ğ¸Ñ†Ğ¸Ñ!)
- ĞŸÑ€Ğ¾Ğ³Ñ€Ğ°Ğ¼Ğ¼Ğ° Ğ¿Ñ‹Ñ‚Ğ°ĞµÑ‚ÑÑ ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ Ğ¾Ğ±Ğ¾Ğ¸Ğ¼ Ğ¿Ğ¾Ğ·Ğ¸Ñ†Ğ¸Ñ U10

**Ğ§Ñ‚Ğ¾ Ğ¿Ñ€Ğ¾Ğ¸ÑÑ…Ğ¾Ğ´Ğ¸Ñ‚:**
```python
# FIX #5 (Ñ€ĞµĞ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ğ½Ğ¾):
if Ğ¿Ğ¾Ğ·Ğ¸Ñ†Ğ¸Ñ_Ğ·Ğ°Ğ½ÑÑ‚Ğ°:
    âš ï¸ ĞšĞ¾Ğ½Ñ„Ğ»Ğ¸ĞºÑ‚!
    â†’ ĞĞ• ÑƒÑÑ‚Ğ°Ğ½Ğ°Ğ²Ğ»Ğ¸Ğ²Ğ°ĞµĞ¼ Ğ¿Ğ¾Ğ·Ğ¸Ñ†Ğ¸Ñ
    â†’ Ğ›Ğ¾Ğ³Ğ¸Ñ€ÑƒĞµĞ¼ warning
    â†’ Telegram ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ğµ
    â†’ stats['rack_conflicts'].append(...)
```

**Ğ”Ğ°Ğ»ÑŒĞ½ĞµĞ¹ÑˆĞ¸Ğµ Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ñ (Ñ€ÑƒÑ‡Ğ½Ñ‹Ğµ):**
1. ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ ĞºĞ°ĞºĞ¾Ğµ ÑƒÑÑ‚Ñ€Ğ¾Ğ¹ÑÑ‚Ğ²Ğ¾ Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ğ¾Ğµ
2. Ğ˜ÑĞ¿Ñ€Ğ°Ğ²Ğ¸Ñ‚ÑŒ inventory Ğ² Zabbix
3. ĞŸÑ€Ğ¸ ÑĞ»ĞµĞ´ÑƒÑÑ‰ĞµĞ¹ ÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸ Ğ¿Ğ¾Ğ·Ğ¸Ñ†Ğ¸Ñ ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑÑ

---

### 9. âš ï¸ Telegram ÑĞ¿Ğ°Ğ¼ Ğ¿Ñ€Ğ¸ Ğ±Ğ¾Ğ»ÑŒÑˆĞ¾Ğ¼ ĞºĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğµ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğ¹

**Ğ¡Ñ†ĞµĞ½Ğ°Ñ€Ğ¸Ğ¹:**
- 100 ÑƒÑÑ‚Ñ€Ğ¾Ğ¹ÑÑ‚Ğ² Ğ¸Ğ·Ğ¼ĞµĞ½Ğ¸Ğ»Ğ¸ÑÑŒ
- ĞŸÑ€Ğ¾Ğ³Ñ€Ğ°Ğ¼Ğ¼Ğ° Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ÑĞµÑ‚ 100 ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ğ¹

**ĞŸÑ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ°:** Telegram rate limiting, ÑĞ¿Ğ°Ğ¼

**Ğ ĞµÑˆĞµĞ½Ğ¸Ğµ:**
- Ğ“Ñ€ÑƒĞ¿Ğ¿Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ñ
- ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ÑÑ‚ÑŒ summary Ğ²Ğ¼ĞµÑÑ‚Ğ¾ Ğ¾Ñ‚Ğ´ĞµĞ»ÑŒĞ½Ñ‹Ñ… ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğ¹
- ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¸Ñ‚ÑŒ TELEGRAM_DISABLE_NOTIFICATION=true Ğ´Ğ»Ñ Ğ½ĞµĞ²Ğ°Ğ¶Ğ½Ñ‹Ñ…

---

### 10. âš ï¸ Site/Location Ğ½Ğµ ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒÑÑ‚

**Ğ¡Ñ†ĞµĞ½Ğ°Ñ€Ğ¸Ğ¹:**
- ĞĞ¾Ğ²Ñ‹Ğ¹ ÑĞµÑ€Ğ²ĞµÑ€ Ñ IP 10.15.1.10
- Subnet 10.15 ĞĞ•Ğ¢ Ğ² SITE_MAPPING
- Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ÑÑ DEFAULT_SITE = "DC Konaeva10"
- ĞĞ¾ ÑÑ‚Ğ° Ğ»Ğ¾ĞºĞ°Ñ†Ğ¸Ñ ÑƒĞ´Ğ°Ğ»ĞµĞ½Ğ° Ğ¸Ğ· NetBox

**Ğ§Ñ‚Ğ¾ Ğ¿Ñ€Ğ¾Ğ¸Ğ·Ğ¾Ğ¹Ğ´ĞµÑ‚:**
```python
site = get_or_create_site(DEFAULT_SITE)  # â†’ None (Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½)
# â†’ ERROR: "Site Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½"
# â†’ SKIP ÑƒÑÑ‚Ñ€Ğ¾Ğ¹ÑÑ‚Ğ²Ğ¾
```

**Ğ ĞµÑˆĞµĞ½Ğ¸Ğµ:**
1. **Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Site/Location Ğ² NetBox Ğ²Ñ€ÑƒÑ‡Ğ½ÑƒÑ Ğ¿ĞµÑ€ĞµĞ´ Ğ·Ğ°Ğ¿ÑƒÑĞºĞ¾Ğ¼**
2. **Ğ˜Ğ»Ğ¸ Ğ²ĞºĞ»ÑÑ‡Ğ¸Ñ‚ÑŒ auto-create:**
```python
if not site:
    site = netbox.dcim.sites.create(
        name=site_name,
        slug=create_slug(site_name)
    )
```

---

## Ğ ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´Ğ¾Ğ²Ğ°Ğ½Ğ½Ğ°Ñ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ

### Ğ‘ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ñ‹Ğµ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ Ğ´Ğ»Ñ production

```bash
# .env

# === Ğ Ğ•Ğ–Ğ˜Ğœ Ğ ĞĞ‘ĞĞ¢Ğ« ===
DRY_RUN=false  # ĞŸĞ¾ÑĞ»Ğµ Ñ‚ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ

# === DECOMMISSIONING (ĞšĞĞĞ¡Ğ•Ğ Ğ’ĞĞ¢Ğ˜Ğ’ĞĞ) ===
DECOMMISSION_AFTER_DAYS=30  # 30 Ğ´Ğ½ĞµĞ¹ Ğ²Ğ¼ĞµÑÑ‚Ğ¾ 1
DELETE_AFTER_DECOMMISSION_DAYS=90  # 90 Ğ´Ğ½ĞµĞ¹ Ğ²Ğ¼ĞµÑÑ‚Ğ¾ 2
ENABLE_PHYSICAL_DELETION=false  # ĞĞ¢ĞšĞ›Ğ®Ğ§Ğ•ĞĞ!

# === REDIS ===
REDIS_TTL=259200  # 3 Ğ´Ğ½Ñ (Ğ±Ğ¾Ğ»ÑŒÑˆĞµ Ñ‡ĞµĞ¼ Ğ¸Ğ½Ñ‚ĞµÑ€Ğ²Ğ°Ğ» ÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸ 2 Ğ´Ğ½Ñ)

# === Ğ—ĞĞ©Ğ˜Ğ¢Ğ Ğ”ĞĞĞĞ«Ğ¥ ===
PROTECTED_FIELDS=comments,description,tags
PROTECTED_CUSTOM_FIELDS=manual_notes,warranty_end,contract_number

# === ĞĞ§Ğ˜Ğ¡Ğ¢ĞšĞ ===
ORPHANED_IP_ACTION=deprecated  # ĞĞµ ÑƒĞ´Ğ°Ğ»ÑĞµĞ¼ ÑÑ€Ğ°Ğ·Ñƒ
CHECK_RACK_CONFLICTS=true  # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ ĞºĞ¾Ğ½Ñ„Ğ»Ğ¸ĞºÑ‚Ñ‹

# === Ğ£Ğ’Ğ•Ğ”ĞĞœĞ›Ğ•ĞĞ˜Ğ¯ ===
TELEGRAM_ENABLED=true
TELEGRAM_DISABLE_NOTIFICATION=false  # ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°Ñ‚ÑŒ Ğ·Ğ²ÑƒĞº
```

### Ğ Ğ°ÑĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ cron

```bash
# ĞšĞ¾Ğ½Ñ‚ĞµĞ¹Ğ½ĞµÑ€ 1: Server Sync
0 2 */2 * * /path/to/run-sync.sh

# ĞšĞ¾Ğ½Ñ‚ĞµĞ¹Ğ½ĞµÑ€ 2: Network Sync (ÑĞ´Ğ²Ğ¸Ğ³ 2 Ñ‡Ğ°ÑĞ°)
0 4 */2 * * /path/to/run-network-sync.sh
```

---

## Ğ§ĞµĞºĞ»Ğ¸ÑÑ‚ Ğ¿ĞµÑ€ĞµĞ´ production

- [ ] Site Ğ¸ Location ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ñ‹ Ğ² NetBox Ğ´Ğ»Ñ Ğ²ÑĞµÑ… Ğ¿Ğ¾Ğ´ÑĞµÑ‚ĞµĞ¹
- [ ] Manufacturer Ğ´Ğ»Ñ Ğ²ÑĞµÑ… Ğ²ĞµĞ½Ğ´Ğ¾Ñ€Ğ¾Ğ² ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ñ‹
- [ ] Custom fields ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ñ‹ Ğ² NetBox (ÑĞ¼. config.py CUSTOM_FIELDS)
- [ ] Redis Ñ persistence Ğ²ĞºĞ»ÑÑ‡ĞµĞ½ (RDB Ğ¸Ğ»Ğ¸ AOF)
- [ ] DECOMMISSION_AFTER_DAYS >= 30
- [ ] ENABLE_PHYSICAL_DELETION=false
- [ ] REDIS_TTL > Ğ¸Ğ½Ñ‚ĞµÑ€Ğ²Ğ°Ğ» ÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸ Ã— 1.5
- [ ] Ğ¢ĞµÑÑ‚Ğ¾Ğ²Ñ‹Ğ¹ Ğ·Ğ°Ğ¿ÑƒÑĞº Ñ DRY_RUN=true ÑƒÑĞ¿ĞµÑˆĞµĞ½
- [ ] Telegram ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ñ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ÑÑ‚
- [ ] Cron Ğ·Ğ°Ğ´Ğ°Ğ½Ğ¸Ñ Ğ½Ğµ ĞºĞ¾Ğ½Ñ„Ğ»Ğ¸ĞºÑ‚ÑƒÑÑ‚ Ğ¿Ğ¾ Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ¸
- [ ] Backup NetBox Ğ¿ĞµÑ€ĞµĞ´ Ğ¿ĞµÑ€Ğ²Ñ‹Ğ¼ Ğ·Ğ°Ğ¿ÑƒÑĞºĞ¾Ğ¼
- [ ] Ğ›Ğ¾Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾ĞµĞ½Ğ¾ (LOG_LEVEL=INFO)

---

**Ğ’ĞµÑ€ÑĞ¸Ñ:** 1.0
**Ğ”Ğ°Ñ‚Ğ°:** 2025-11-17
**Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ:** Production Ready (Ñ ĞºĞ¾Ğ½ÑĞµÑ€Ğ²Ğ°Ñ‚Ğ¸Ğ²Ğ½Ñ‹Ğ¼Ğ¸ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ°Ğ¼Ğ¸)
